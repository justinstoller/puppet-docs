<!DOCTYPE html>
<html dir="ltr" lang="en-US">
  <head>
  	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  	<title>Documentation | Puppet Labs - Learning â€” Modules 1</title>
  	<meta name="description" content="The open source leader in data center automation">
  	<link rel="alternate" type="text/xml" title="Puppet Labs RSS 0.92 Feed" href="http://puppetlabs.com/feed/rss/">
  	<link rel="alternate" type="application/atom+xml" title="Puppet Labs Atom Feed" href="http://puppetlabs.com/feed/atom/">
  	<link rel="alternate" type="application/rss+xml" title="Puppet Labs RSS 2.0 Feed" href="http://puppetlabs.com/feed/">
  	<link rel="pingback" href="http://puppetlabs.com/xmlrpc.php">
    <link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://puppetlabs.com/xmlrpc.php?rsd" />
    <link rel='index' title='Puppet Labs' href='http://docs.puppetlabs.com' />

<!-- Google stats -->
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-1537572-5");
pageTracker._setDomainName(".puppetlabs.com");
pageTracker._trackPageview();
} catch(err) {}</script>
<!-- End Google stats -->


    <!-- FIXME: absolute paths -->

    <script type='text/javascript' src='/files/javascripts/html5.js'></script>
    <script type='text/javascript' src='/files/javascripts/jquery-1.3.2.min.js'></script>
    <script type='text/javascript' src='/files/javascripts/drop_down.js'></script>
    <script type='text/javascript' src='/files/javascripts/cufon-yui.js'></script>
    <script type='text/javascript' src='/files/fonts/Klavika_400-Klavika_600.font.js'></script>
    <script type='text/javascript' src='/files/javascripts/ampersands.js'></script>

     <!--Add rotation jQuery Script -->
	 	
    <script type='text/javascript' src='/files/javascripts/addRotate.js'></script>

    <!-- All in One SEO Pack 1.6.10.1 by Michael Torbert of Semper Fi Web Design[127,146] -->
    <meta name="keywords" content="Puppet, puppet labs, reductive labs, open source, system administrator, ruby, data center, automation, support" />
    <link rel="canonical" href="http://docs.puppetlabs.com" />
    <!-- /all in one seo pack -->
	
    <!-- FIXME: absolute paths -->

    <link rel="stylesheet" type="text/css" href="/files/stylesheets/style.css" media="screen"> 
    <link rel="stylesheet" type="text/css" href="/files/stylesheets/syntax.css" media="screen"> <!-- index -->
    <link rel="stylesheet" type="text/css" href="/files/stylesheets/adbanner.css" media="screen">

    <!--[if IE 7]>
	  <link rel="stylesheet" type="text/css" href="/files/stylesheets/ie_7.css" media="screen"> <!-- index -->
    <![endif]-->
  
    <!--[if IE 8]>
	    <link rel="stylesheet" type="text/css" href="/files/stylesheets/ie_8.css" media="screen"> <!-- index -->
    <![endif]-->		

  	<script type="text/javascript">
      Cufon.replace('h1, h2', { fontWeight: '600' });
  	</script>
</head>



        
  <body id="puppetlabsdocs" class="docs">
  <style type="text/css">h1, h2{ visibility : hidden }</style>		
  <!--[if IE 8]>
    <style type="text/css">h1, h2{ visibility : visible }</style>
  <![endif]-->		

  	<header id="header">
      <div class="site-width">
    		<h1><a href="http://puppetlabs.com/"><span>Puppet Labs</span></a></h1>
        <a class="screen-reader-content" href="#content">Skip navigation</a>
        <nav>
    		<ul id="global-navigation">
          <li id="puppet-tab" class="with-submenu">
            <a href="http://www.puppetlabs.com/puppet/">
              <span>Products</span>

              <span class="drop-down-trigger"></span>
            </a>
            <ul>            
              <li>
                <ul>
<li class="page_item page-item-769"><a href="http://www.puppetlabs.com/puppet/puppet-enterprise/" title="Puppet Enterprise">Puppet Enterprise</a></li>
<li class="page_item page-item-757"><a href="http://www.puppetlabs.com/puppet/introduction/" title="Puppet">Puppet</a></li>
<li class="page_item page-item-956"><a href="http://www.puppetlabs.com/puppet/how-to-buy/" title="How to Buy">How to Buy</a></li>
<li class="page_item page-item-1159"><a href="http://forge.puppetlabs.com/" title="Module Forge">Module Forge</a></li>

<li class="page_item page-item-2415"><a href="http://www.puppetlabs.com/mcollective/introduction/" title="MCollective">MCollective</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li id="services-tab" class="with-submenu">
            <a href="http://www.puppetlabs.com/services/">
              <span>Services</span>
              <span class="drop-down-trigger"></span>

            </a>
            <ul>
              <li class="page_item page-item-783"><a href="http://www.puppetlabs.com/services/overview/" title="Overview">Overview</a></li>
<li class="page_item page-item-839"><a href="http://www.puppetlabs.com/services/support/" title="Enterprise Support">Enterprise Support</a></li>
<li class="page_item page-item-845"><a href="http://www.puppetlabs.com/services/training-workshops/" title="On-Site Training &amp; Consulting">On-Site Training &amp; Consulting</a></li>
<li class="page_item page-item-849"><a href="/category/events/upcoming/" title="Events &amp; Public Training">Events &amp; Public Training</a></li>
<li class="page_item page-item-851"><a href="http://www.puppetlabs.com/services/partners/" title="Partners">Partners</a></li>
<li class="page_item page-item-1037"><a href="/resources/customer-support" title="Customer Support">Customer Support</a></li>
            </ul>
          </li>
          <li id="resources-tab" class="with-submenu">
            <a href="http://www.puppetlabs.com/resources/">
              <span>Resources</span>

              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-1048"><a href="http://www.puppetlabs.com/resources/overview-2/" title="Overview">Overview</a></li>
<li class="page_item page-item-1052"><a href="http://www.puppetlabs.com/resources/customer-support/" title="Customer Support">Customer Support</a></li>
<li class="page_item page-item-1040"><a href="http://docs.puppetlabs.com" title="Documentation">Documentation</a></li>
<li class="page_item page-item-872"><a href="http://info.puppetlabs.com/register-download" title="Downloads">Downloads</a></li>
<li class="page_item page-item-1961"><a href="http://forge.puppetlabs.com" title="Module Forge">Module Forge</a></li>
<li class="page_item page-item-835"><a href="http://info.puppetlabs.com/request-whitepapers.html" title="White Papers">White Papers</a></li>
<li class="page_item page-item-1967"><a href="http://projects.puppetlabs.com/projects/puppet/wiki" title="Wiki">Wiki</a></li>
            </ul>

          </li>

<li id="customer-tab" class="with-submenu">
            <a href="http://www.puppetlabs.com/customers/companies/">
              <span>Customers</span>

              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-1048"><a href="http://www.puppetlabs.com/customers/companies/" title="Overview">Companies</a></li>
<li class="page_item page-item-1052"><a href="http://www.puppetlabs.com/customers/case-studies/" title="Case Studies">Case Studies</a></li>
<li class="page_item page-item-1040"><a href="http://www.puppetlabs.com/customers/product-testimonials/" title="Product Testimonials">Product Testimonials</a></li>
<li class="page_item page-item-872"><a href="http://www.puppetlabs.com/customers/what-customers-are-saying/" title="ervice Testimonials">Service Testimonials</a></li>
	</ul>
          </li>
         <li id="community-tab" class="with-submenu">
            <a href="http://www.puppetlabs.com/community/">
              <span>Community</span>

              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-2195"><a href="http://www.puppetlabs.com/community/overview/" title="Overview">Overview</a></li>
<li class="page_item page-item-2195"><a href="http://www.puppetlabs.com/blog" title="Blog">Blog</a></li>
<li class="page_item page-item-2264"><a href="http://www.puppetlabs.com/community/puppet-camp/" title="Puppet Camp">Puppet Camp</a></li>
<li class="page_item page-item-2249"><a href="http://www.puppetlabs.com/community/user-groups-and-devops-groups/" title="User Groups &amp; DevOps Groups">User Groups &amp; DevOps Groups</a></li>
<li class="page_item page-item-2215"><a href="http://www.puppetlabs.com/community/presentations/" title="Presentations">Presentations</a></li>

<li class="page_item page-item-2217"><a href="http://www.puppetlabs.com/community/videos/" title="Videos">Videos</a></li>
<li class="page_item page-item-2217"><a href="http://www.puppetlabs.com/community/badges/" title="Badges">Badges</a></li>
            </ul>
          </li>

          <li id="company-tab" class="with-submenu">
            <a href="http://www.puppetlabs.com/company/">
              <span>Company</span>
              <span class="drop-down-trigger"></span>
            </a>

            <ul>
              <li class="page_item page-item-2316"><a href="http://www.puppetlabs.com/company/overview/" title="Overview">Overview</a></li>
<li class="page_item page-item-2179"><a href="http://www.puppetlabs.com/company/news/" title="News">News</a></li>
<li class="page_item page-item-1571"><a href="http://www.puppetlabs.com/company/jobs/" title="Jobs">Jobs</a></li>
<li class="page_item page-item-2313"><a href="http://www.puppetlabs.com/company/contact-us/" title="Contact Us">Contact Us</a></li>
            </ul>
          </li>
    		</ul>	   
          <div id="misc-navigation">

			  <ul>
				<li><a href="http://docs.puppetlabs.com">Documentation</a></li>
				<li><a href="http://puppetlabs.com/resources/customer-support/">Support</a></li>
				<li><a href="http://projects.puppetlabs.com/">Bug Tracker</a></li>
				<li><a href="http://puppetlabs.com/company/#contact">Contact Us</a></li>
				<li><a href="http://puppetlabs.com/resources/downloads" class="gateway">Download</a></li>
			  </ul>
			<form action="http://www.google.com/cse" id="cse-search-box">

			  <div>
				<input type="hidden" name="cx" value="017884045025332504017:1mnj-dlgfcc" />
				<input type="hidden" name="ie" value="UTF-8" />
				<input type="text" name="q" size="31" />
				<input type="submit" name="sa" class="searchbtn" value="Search" />
			  </div>
			</form>
			<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en"></script>

          </div>
      </nav>
    	</div>
    </header>  

      <section id="masthead">
        <div class="site-width">
          <h1>Docs: <span class="section-name">Learning â€” Modules 1</span></h1>
          <ul id="doc-navigation">
            <li><a href="/">Docs Home</a></li>
            <li class="with-submenu">
              <a href="#">
                <span>Quick Nav</span>
                <span class="drop-down-trigger"></span>
              </a>
               <!-- the following links can't be relative, unfortunately -->
               <!-- future: add some JS to disable this if running from file:// -->
               	            <dl>
	              <dt>Puppet Guides</dt>
                      <dd><a href="/index.html">Index</a></dd>
                  <dt>Puppet References</dt>
                      <dd><a href="/references/stable/type.html">Resource Types</a></dd>
                      <dd><a href="/references/stable/function.html">Functions</a></dd>
                      <dd><a href="/references/stable/metaparameter.html">Metaparameters</a></dd>
                      <dd><a href="/references/stable/configuration.html">Configuration</a></dd>
                      <dt>References By Version</dt>
                      <dd><a href="/references/2.7.3/">2.7.3</a></dd>
                      <dd><a href="/references/2.6.9/">2.6.9</a></dd>
                      <dd><a href="/references/0.25.5/">0.25.5</a></dd>
                      <dd><a href="/references/0.24.8/">0.24.8</a></dd>
                      <dd><a href="/references/">Other Versions</a></dd>
                  <dt>MCollective</dt>
                      <dd><a href="/mcollective/index.html">Index</a></dd>
                      <dd><a href="/mcollective/simplerpc/index.html">SimpleRPC</a></dd>
                      <dd><a href="/mcollective/roadmap/index.html">Roadmap</a></dd>
                      <dd><a href="/mcollective/releasenotes.html">Release Notes</a></dd>
                      <dd><a href="/mcollective/reference/index.html">References</a></dd>
	            </dl>

            </li>
            <li><a href="/contribute.html">Contribute</a></li>
          </ul>
        </div>
      </section>
    
      <section id="content">
        <div class="site-width">
          <div class="primary-secondary-content">
            <div class="primary-content">
              <h1 id="learning--modules-and-classes-part-one">Learning â€” Modules and Classes (Part One)</h1>

<p>You can write some pretty sophisticated manifests at this point, but they&rsquo;re still at a fairly low altitude, going resource-by-resource-by-resource. Now, zoom out with resource collections. </p>

<hr />

<p>&larr; <a href="./variables.html">Variables, etc.</a> &mdash; <a href="./">Index</a> &mdash; <a href="./templates.html">Templates</a> &rarr;</p>

<hr />

<h2 id="collecting-and-reusing">Collecting and Reusing</h2>

<p>At some point, you&rsquo;re going to have Puppet code that fits into a couple of different buckets: really general stuff that applies to all your machines, more specialized stuff that only applies to certain classes of machines, and very specific stuff that&rsquo;s meant for a few nodes at most. </p>

<p>So&hellip; you <em>could</em> just paste in all your more general code as boilerplate atop your more specific code. There are ways to do that and get away with it. But that&rsquo;s the road down into the valley of the 4,000-line manifest. Better to separate your code out into meaningful units and then call those units by name as needed. </p>

<p>Thus, resource collections and modules! In a few minutes, you&rsquo;ll be able to maintain your manifest code in one place and declare whole groups of it like this: </p>

<pre><code>class {'security_base': }
class {'webserver_base': }
class {'appserver': }
</code></pre>

<p>And after that, it&rsquo;ll get even better. But first things first.</p>

<h2 id="classes">Classes</h2>

<p>Classes are singleton collections of resources that Puppet can apply as a unit. You can think of them as blocks of code that can be turned on or off.</p>

<p>If you know any object-oriented programming, try to ignore it for a little while, because that&rsquo;s not the kind of class we&rsquo;re talking about. Puppet classes could also be called &ldquo;roles&rdquo; or &ldquo;aspects;&rdquo; they describe one part of what makes up a system&rsquo;s identity.</p>

<h3 id="defining">Defining</h3>

<p>Before you can use a class, you have to <strong>define</strong> it, which is done with the <code>class</code> keyword, a name, and a block of code: </p>

<pre><code>class someclass { 
  ... 
}
</code></pre>

<p>Well, hey: you have a block of code hanging around from last chapter&rsquo;s exercises, right? Chuck it in!</p>

<div class="highlight"><pre><code class="ruby">    <span class="c1"># ntp-class1.pp</span>
    
    <span class="k">class</span> <span class="n">ntp</span> <span class="p">{</span>
      <span class="k">case</span> <span class="vg">$operatingsystem</span> <span class="p">{</span>
        <span class="n">centos</span><span class="p">,</span> <span class="n">redhat</span><span class="p">:</span> <span class="p">{</span> 
          <span class="vg">$service_name</span> <span class="o">=</span> <span class="s1">&#39;ntpd&#39;</span>
          <span class="vg">$conf_file</span>    <span class="o">=</span> <span class="s1">&#39;ntp.conf.el&#39;</span>
        <span class="p">}</span>
        <span class="n">debian</span><span class="p">,</span> <span class="n">ubuntu</span><span class="p">:</span> <span class="p">{</span> 
          <span class="vg">$service_name</span> <span class="o">=</span> <span class="s1">&#39;ntp&#39;</span>
          <span class="vg">$conf_file</span>    <span class="o">=</span> <span class="s1">&#39;ntp.conf.debian&#39;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      
      <span class="n">package</span> <span class="p">{</span> <span class="s1">&#39;ntp&#39;</span><span class="p">:</span>
        <span class="k">ensure</span> <span class="o">=&gt;</span> <span class="n">installed</span><span class="p">,</span>
      <span class="p">}</span>
      
      <span class="n">service</span> <span class="p">{</span> <span class="s1">&#39;ntp&#39;</span><span class="p">:</span>
        <span class="nb">name</span>      <span class="o">=&gt;</span> <span class="vg">$service_name</span><span class="p">,</span>
        <span class="k">ensure</span>    <span class="o">=&gt;</span> <span class="n">running</span><span class="p">,</span>
        <span class="n">enable</span>    <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span>
        <span class="n">subscribe</span> <span class="o">=&gt;</span> <span class="no">File</span><span class="o">[</span><span class="s1">&#39;ntp.conf&#39;</span><span class="o">]</span><span class="p">,</span>
      <span class="p">}</span>
      
      <span class="n">file</span> <span class="p">{</span> <span class="s1">&#39;ntp.conf&#39;</span><span class="p">:</span>
        <span class="n">path</span>    <span class="o">=&gt;</span> <span class="s1">&#39;/etc/ntp.conf&#39;</span><span class="p">,</span>
        <span class="k">ensure</span>  <span class="o">=&gt;</span> <span class="n">file</span><span class="p">,</span>
        <span class="nb">require</span> <span class="o">=&gt;</span> <span class="no">Package</span><span class="o">[</span><span class="s1">&#39;ntp&#39;</span><span class="o">]</span><span class="p">,</span>
        <span class="n">source</span>  <span class="o">=&gt;</span> <span class="s2">&quot;/root/learning-manifests/${conf_file}&quot;</span><span class="p">,</span>
      <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>Go ahead and apply that. In the meantime:</p>

<h4 id="an-aside-names-namespaces-and-scope">An Aside: Names, Namespaces, and Scope</h4>

<p>Class names have to start with a lowercase letter, and can contain lowercase alphanumeric characters and underscores. (Just your standard slightly conservative set of allowed characters.)</p>

<p>Class names can also use a double colon (<code>::</code>) as a namespace separator. (Yes, this should <a href="./variables.html#variables">look familiar</a>.) This is a good way to show which classes are related to each other; for example, you can tell right away that something&rsquo;s going on between <code>apache::ssl</code> and <code>apache::vhost</code>. This will become more important about <a href="#namespacing-and-autoloading">two feet south of here</a>. </p>

<p>Also, class definitions introduce new variable scopes. That means any variables you assign within won&rsquo;t be accessible by their short names outside the class; to get at them from elsewhere, you would have to use the fully-qualified name (e.g. <code>$apache::ssl::certificate_expiration</code>). It also means you can localize &mdash; mask &mdash; variable short names in use outside the class; if you assign a <code>$fqdn</code> variable in a class, you would get the new value instead of the value of the Facter-supplied variable, unless you used the fully-qualified fact name (<code>$::fqdn</code>). </p>

<h3 id="declaring">Declaring</h3>

<p>Okay, back to our example, which you&rsquo;ll have noticed by now doesn&rsquo;t actually <em>do</em> anything.</p>

<pre><code># puppet apply ntp-class1.pp
(...silence)
</code></pre>

<p>The code inside the class was properly parsed, but the compiler didn&rsquo;t build any of it into the catalog, so none of the resources got synced. For that to happen, the class has to be declared.</p>

<p>You actually already know the syntax to do that. A class definition just enables a unique instance of the <code>class</code> resource type; once it&rsquo;s defined, you can declare it like any other resource:</p>

<div class="highlight"><pre><code class="ruby">    <span class="c1"># ntp-class1.pp</span>
    
    <span class="k">class</span> <span class="n">ntp</span> <span class="p">{</span>
      <span class="k">case</span> <span class="vg">$operatingsystem</span> <span class="p">{</span>
        <span class="n">centos</span><span class="p">,</span> <span class="n">redhat</span><span class="p">:</span> <span class="p">{</span> 
          <span class="vg">$service_name</span> <span class="o">=</span> <span class="s1">&#39;ntpd&#39;</span>
          <span class="vg">$conf_file</span>    <span class="o">=</span> <span class="s1">&#39;ntp.conf.el&#39;</span>
        <span class="p">}</span>
        <span class="n">debian</span><span class="p">,</span> <span class="n">ubuntu</span><span class="p">:</span> <span class="p">{</span> 
          <span class="vg">$service_name</span> <span class="o">=</span> <span class="s1">&#39;ntp&#39;</span>
          <span class="vg">$conf_file</span>    <span class="o">=</span> <span class="s1">&#39;ntp.conf.debian&#39;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      
      <span class="n">package</span> <span class="p">{</span> <span class="s1">&#39;ntp&#39;</span><span class="p">:</span>
        <span class="k">ensure</span> <span class="o">=&gt;</span> <span class="n">installed</span><span class="p">,</span>
      <span class="p">}</span>
      
      <span class="n">service</span> <span class="p">{</span> <span class="s1">&#39;ntp&#39;</span><span class="p">:</span>
        <span class="nb">name</span>      <span class="o">=&gt;</span> <span class="vg">$service_name</span><span class="p">,</span>
        <span class="k">ensure</span>    <span class="o">=&gt;</span> <span class="n">running</span><span class="p">,</span>
        <span class="n">enable</span>    <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span>
        <span class="n">subscribe</span> <span class="o">=&gt;</span> <span class="no">File</span><span class="o">[</span><span class="s1">&#39;ntp.conf&#39;</span><span class="o">]</span><span class="p">,</span>
      <span class="p">}</span>
      
      <span class="n">file</span> <span class="p">{</span> <span class="s1">&#39;ntp.conf&#39;</span><span class="p">:</span>
        <span class="n">path</span>    <span class="o">=&gt;</span> <span class="s1">&#39;/etc/ntp.conf&#39;</span><span class="p">,</span>
        <span class="k">ensure</span>  <span class="o">=&gt;</span> <span class="n">file</span><span class="p">,</span>
        <span class="nb">require</span> <span class="o">=&gt;</span> <span class="no">Package</span><span class="o">[</span><span class="s1">&#39;ntp&#39;</span><span class="o">]</span><span class="p">,</span>
        <span class="n">source</span>  <span class="o">=&gt;</span> <span class="s2">&quot;/root/learning-manifests/${conf_file}&quot;</span><span class="p">,</span>
      <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="c1"># Then, declare it:</span>
    <span class="k">class</span> <span class="p">{</span><span class="s1">&#39;ntp&#39;</span><span class="p">:</span> <span class="p">}</span>
</code></pre>
</div>

<p>This time, all those resources will end up in the catalog:</p>

<pre><code># puppet apply --verbose ntp-class1.pp

info: Applying configuration version '1305066883'
info: FileBucket adding /etc/ntp.conf as {md5}5baec8bdbf90f877a05f88ba99e63685
info: /Stage[main]/Ntp/File[ntp.conf]: Filebucketed /etc/ntp.conf to puppet with sum 5baec8bdbf90f877a05f88ba99e63685
notice: /Stage[main]/Ntp/File[ntp.conf]/content: content changed '{md5}5baec8bdbf90f877a05f88ba99e63685' to '{md5}dc20e83b436a358997041a4d8282c1b8'
info: /Stage[main]/Ntp/File[ntp.conf]: Scheduling refresh of Service[ntp]
notice: /Stage[main]/Ntp/Service[ntp]/ensure: ensure changed 'stopped' to 'running'
notice: /Stage[main]/Ntp/Service[ntp]: Triggered 'refresh' from 1 events
</code></pre>

<p>Defining the class makes it available; declaring activates it.</p>

<h4 id="include">Include</h4>

<p>There&rsquo;s another way to declare classes, but it behaves a little bit differently:</p>

<pre><code>include ntp
include ntp
include ntp
</code></pre>

<p>The <code>include</code> function will declare a class if it hasn&rsquo;t already been declared, and will do nothing if it has. This means you can safely use it multiple times, whereas the resource syntax can only be used once. The drawback is that <code>include</code> can&rsquo;t currently be used with parameterized classes, on which more later.</p>

<p>So which should you choose? Neither, yet: learn to use both, and decide later, after we&rsquo;ve covered site design and parameterized classes.</p>

<h3 id="classes-in-situ">Classes In Situ</h3>

<p>You&rsquo;ve probably already guessed that classes aren&rsquo;t enough: even with the code above, you&rsquo;d still have to paste the <code>ntp</code> definition into all your other manifests. So it&rsquo;s time to meet the <strong>module autoloader!</strong></p>

<h4 id="an-aside-printing-config">An Aside: Printing Config</h4>

<p>But first, we&rsquo;ll need to meet its friend, the <code>modulepath</code>.</p>

<pre><code># puppet apply --configprint modulepath
/etc/puppetlabs/puppet/modules
</code></pre>

<p>By the way, <code>--configprint</code> is wonderful. Puppet has a <em>lot</em> of <a href="http://docs.puppetlabs.com/references/stable/configuration.html">config options</a>, all of which have default values and site-specific overrides in puppet.conf, and trying to memorize them all is a pain. You can use <code>--configprint</code> on  most of the Puppet tools, and they&rsquo;ll print a value (or a bunch, if you use <code>--configprint all</code>) and exit.</p>

<p>(As for the <a href="http://docs.puppetlabs.com/references/stable/configuration.html#modulepath">modulepath</a>, it looks like a single directory at the moment but is actually a colon-separated<sup id="fnref:pathseparator"><a href="#fn:pathseparator" rel="footnote">1</a></sup> list of directories.)</p>

<h2 id="modules">Modules</h2>

<p>So anyway, modules are re-usable bundles of code and data. Puppet autoloads manifests from the modules in its <code>modulepath</code>, which means you can declare a class stored in a module from anywhere. Let&rsquo;s just convert that last class to a module immediately, so you can see what I&rsquo;m talking about:</p>

<pre><code># cd /etc/puppetlabs/puppet/modules
# mkdir ntp; cd ntp; mkdir manifests; cd manifests
# vim init.pp
</code></pre>

<div class="highlight"><pre><code class="ruby">    <span class="c1"># init.pp</span>
    
    <span class="k">class</span> <span class="n">ntp</span> <span class="p">{</span>
      <span class="k">case</span> <span class="vg">$operatingsystem</span> <span class="p">{</span>
        <span class="n">centos</span><span class="p">,</span> <span class="n">redhat</span><span class="p">:</span> <span class="p">{</span> 
          <span class="vg">$service_name</span> <span class="o">=</span> <span class="s1">&#39;ntpd&#39;</span>
          <span class="vg">$conf_file</span>    <span class="o">=</span> <span class="s1">&#39;ntp.conf.el&#39;</span>
        <span class="p">}</span>
        <span class="n">debian</span><span class="p">,</span> <span class="n">ubuntu</span><span class="p">:</span> <span class="p">{</span> 
          <span class="vg">$service_name</span> <span class="o">=</span> <span class="s1">&#39;ntp&#39;</span>
          <span class="vg">$conf_file</span>    <span class="o">=</span> <span class="s1">&#39;ntp.conf.debian&#39;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      
      <span class="n">package</span> <span class="p">{</span> <span class="s1">&#39;ntp&#39;</span><span class="p">:</span>
        <span class="k">ensure</span> <span class="o">=&gt;</span> <span class="n">installed</span><span class="p">,</span>
      <span class="p">}</span>
      
      <span class="n">service</span> <span class="p">{</span> <span class="s1">&#39;ntp&#39;</span><span class="p">:</span>
        <span class="nb">name</span>      <span class="o">=&gt;</span> <span class="vg">$service_name</span><span class="p">,</span>
        <span class="k">ensure</span>    <span class="o">=&gt;</span> <span class="n">running</span><span class="p">,</span>
        <span class="n">enable</span>    <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span>
        <span class="n">subscribe</span> <span class="o">=&gt;</span> <span class="no">File</span><span class="o">[</span><span class="s1">&#39;ntp.conf&#39;</span><span class="o">]</span><span class="p">,</span>
      <span class="p">}</span>
      
      <span class="n">file</span> <span class="p">{</span> <span class="s1">&#39;ntp.conf&#39;</span><span class="p">:</span>
        <span class="n">path</span>    <span class="o">=&gt;</span> <span class="s1">&#39;/etc/ntp.conf&#39;</span><span class="p">,</span>
        <span class="k">ensure</span>  <span class="o">=&gt;</span> <span class="n">file</span><span class="p">,</span>
        <span class="nb">require</span> <span class="o">=&gt;</span> <span class="no">Package</span><span class="o">[</span><span class="s1">&#39;ntp&#39;</span><span class="o">]</span><span class="p">,</span>
        <span class="n">source</span>  <span class="o">=&gt;</span> <span class="s2">&quot;/root/learning-manifests/${conf_file}&quot;</span><span class="p">,</span>
      <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="c1"># (Remember not to declare the class yet.)</span>
</code></pre>
</div>

<p>And now, the reveal:<sup id="fnref:dashe"><a href="#fn:dashe" rel="footnote">2</a></sup></p>

<pre><code># cd ~
# puppet apply -e "include ntp"
</code></pre>

<p>Which works! You can now include the class from any manifest, without having to cut and paste anything. </p>

<p>But we&rsquo;re not quite done yet. See how the manifest is referring to some files stored outside the module? Let&rsquo;s fix that:</p>

<pre><code># mkdir /etc/puppetlabs/puppet/modules/ntp/files
# mv /root/learning-manifests/ntp.conf.* /etc/puppetlabs/puppet/modules/ntp/files/
# vim /etc/puppetlabs/puppet/modules/ntp/manifests/init.pp
</code></pre>

<div class="highlight"><pre><code class="ruby">    <span class="c1"># ...</span>
      <span class="n">file</span> <span class="p">{</span> <span class="s1">&#39;ntp.conf&#39;</span><span class="p">:</span>
        <span class="n">path</span>     <span class="o">=&gt;</span> <span class="s1">&#39;/etc/ntp.conf&#39;</span><span class="p">,</span>
        <span class="k">ensure</span>   <span class="o">=&gt;</span> <span class="n">file</span><span class="p">,</span>
        <span class="nb">require</span>  <span class="o">=&gt;</span> <span class="no">Package</span><span class="o">[</span><span class="s1">&#39;ntp&#39;</span><span class="o">]</span><span class="p">,</span>
        <span class="c1"># source =&gt; &quot;/root/learning-manifests/${conf_file}&quot;,</span>
        <span class="n">source</span>   <span class="o">=&gt;</span> <span class="s2">&quot;puppet:///modules/ntp/${conf_file}&quot;</span><span class="p">,</span>
      <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>There &mdash; our little example from last chapter has grown up into a self-contained blob of awesome.</p>

<h2 id="module-structure">Module Structure</h2>

<p>A module is just a directory with stuff in it, and the magic comes from putting that stuff where Puppet expects to find it. Which is to say, arranging the contents like this:</p>

<ul>
  <li>{module}/
    <ul>
      <li>files/</li>
      <li>lib/</li>
      <li>manifests/
        <ul>
          <li>init.pp</li>
          <li>{class}.pp</li>
          <li>{defined type}.pp</li>
          <li>{namespace}/
            <ul>
              <li>{class}.pp</li>
              <li>{class}.pp</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>templates/</li>
      <li>tests/</li>
    </ul>
  </li>
</ul>

<p>The main directory should be named after the module. All of the manifests go in the <code>manifests</code> directory. Each manifest contains only one class (or defined type). There&rsquo;s a special manifest called <code>init.pp</code> that holds the module&rsquo;s main class, which should have the same name as the module. That&rsquo;s your barest-bones module: main folder, manifests folder, init.pp, just like we used in the ntp module above. </p>

<p>But if that was all a module was, it&rsquo;d make more sense to just load your classes from one flat folder. Modules really come into their own with namespacing and grouping of classes. </p>

<h3 id="manifests-namespacing-and-autoloading">Manifests, Namespacing, and Autoloading</h3>

<p>The manifests directory can hold any number of other classes and even folders of classes, and Puppet uses <a href="#an-aside-names-and-namespaces">namespacing</a> to find them. Say we have a manifests folder that looks like this: </p>

<ul>
  <li>foo/
    <ul>
      <li>manifests/
        <ul>
          <li>init.pp</li>
          <li>bar.pp</li>
          <li>bar/
            <ul>
              <li>baz.pp</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>The init.pp file should contain <code>class foo { ... }</code>, bar.pp should contain <code>class foo::bar { ... }</code>, and baz.pp should contain <code>class foo::bar::baz { ... }</code>. </p>

<p>This can be a little disorienting at first, but I promise you&rsquo;ll get used to it. Basically, init.pp is special, and all of the other classes (each in its own manifest) should be under the main class&rsquo;s namespace. If you add more levels of directory hierarchy, they get interpreted as more levels of namespace hierarchy. This lets you group related classes together, or split the implementation of a complex resource collection out into conceptually separate bits. </p>

<h3 id="files">Files</h3>

<p>Puppet can serve files from modules, and it works identically regardless of whether you&rsquo;re doing serverless or agent/master Puppet. Everything in the <code>files</code> directory in the ntp module is available under the <code>puppet:///modules/ntp/</code> URL. Likewise, a <code>test.txt</code> file in the <code>testing</code> module&rsquo;s <code>files</code> could be retrieved as <code>puppet:///modules/testing/test.txt</code>. </p>

<h3 id="tests">Tests</h3>

<p>Once you start writing modules you plan to keep for more than a day or two, read our brief guide to <a href="http://docs.puppetlabs.com/guides/tests_smoke.html">module smoke testing</a>. It&rsquo;s pretty simple, and will eventually pay off. </p>

<h3 id="templates">Templates</h3>

<p>More on <a href="http://docs.puppetlabs.com/guides/templating.html">templates</a> later.</p>

<h3 id="lib">Lib</h3>

<p>Puppet modules can also serve executable Ruby code from their <code>lib</code> directories, to extend Puppet and Facter. (Remember how I mentioned extending Facter with custom facts? This is where they live.) It&rsquo;ll be a while before we cover any of that.</p>

<h3 id="module-scaffolding">Module Scaffolding</h3>

<p>Since you&rsquo;ll be dealing with those same five subdirectories so much, consider adding a function for them to your ~/.bashrc file. </p>

<pre><code>mkmod() {
    mkdir "$1"
    mkdir "$1/files" "$1/lib" "$1/manifests" "$1/templates" "$1/tests"
}
</code></pre>

<h2 id="exercises">Exercises</h2>

<blockquote>
  <p><strong>Exercise:</strong> Build an Apache2 module and class, which ensures Apache is installed and running and manages its config file. While you&rsquo;re at it, make Puppet manage the DocumentRoot and put a custom 404 page and default index.html in place. </p>

  <p>Set any files or package/service names that might vary per distro conditionally, failing if we&rsquo;re not on CentOS; this&rsquo;ll let you cleanly shim in support for other distros once you need it.</p>

  <p>We&rsquo;ll be using this module some more in future lessons.</p>
</blockquote>

<h2 id="next">Next</h2>

<p>So what&rsquo;s with those static config files we&rsquo;re shipping around? If our classes can do different things on different systems, shouldn&rsquo;t our <code>ntp.conf</code> and <code>httpd.conf</code> files be able to do the same? <a href="./templates.html">Yes. Yes they should.</a></p>
<div class="footnotes">
  <ol>
    <li id="fn:pathseparator">
      <p>Well, system path separator-separated. On POSIX systems, that&rsquo;s a colon; on Windows, it&rsquo;s a semicolon. <a href="#fnref:pathseparator" rev="footnote">&#8617;</a></p>
    </li>
    <li id="fn:dashe">
      <p>The <code>-e</code> flag lets you give puppet apply a line of manifest code instead of a file, same as with Perl or Ruby.<a href="#fnref:dashe" rev="footnote">&#8617;</a></p>
    </li>
  </ol>
</div>

            </div>
            <div class="secondary-content">
                  <div id="subCol">
                  
                  
                      <h3 class="chapter">Contents</h3>
                      
<ol class="toc">
  <li class="toc-lv2"><a href="#collecting-and-reusing">Collecting and Reusing</a></li>
  <li class="toc-lv2"><a href="#classes">Classes</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#defining">Defining</a></li>
   <li class="toc-lv3"><a href="#declaring">Declaring</a></li>
   <li class="toc-lv3"><a href="#classes-in-situ">Classes In Situ</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#modules">Modules</a></li>
  <li class="toc-lv2"><a href="#module-structure">Module Structure</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#manifests-namespacing-and-autoloading">Manifests, Namespacing, and Autoloading</a></li>
   <li class="toc-lv3"><a href="#files">Files</a></li>
   <li class="toc-lv3"><a href="#tests">Tests</a></li>
   <li class="toc-lv3"><a href="#templates">Templates</a></li>
   <li class="toc-lv3"><a href="#lib">Lib</a></li>
   <li class="toc-lv3"><a href="#module-scaffolding">Module Scaffolding</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#exercises">Exercises</a></li>
  <li class="toc-lv2"><a href="#next">Next</a></li>
</ol>
                  
                                        <!-- New Ads are inserted here -->
		  			<div id="bannerImage" style="display:block;">&nbsp;</div>
		  			<!-- Remove me on September 24 --><a href="http://bit.ly/puppetconf"><img src="http://www.puppetlabs.com/wp-content/uploads/2011/07/120x600_puppetconf.png" style="display:block; margin-left: auto; margin-right: auto;"></a>
                  </div>
            </div>
          </div>
        </div>
      </section>

		<footer id="footer">
      <div class="site-width">

        <div class="primary-secondary-content">
          <div class="primary-content">
            <section id="newsletter">
                 <h4>Puppet Labs is Hiring</h4>
                 <p><a href="http://www.puppetlabs.com/company/jobs/">Engineers, developers & consultants</a>
                  <p>  
		<h4>Newsletter</h4>

              <p>Stay up to date on all things puppet</p>
              
				<form class="lpeRegForm formNotEmpty" method="post" enctype="application/x-www-form-urlencoded" action="http://info.puppetlabs.com/index.php/leadCapture/save"; id="mktForm_1013" name="mktForm_1013">
				
				<label>Email Address:</label><span class='mktInput'><input class='mktFormText mktFormEmail' name="Email" id="Email" type='text' value="" maxlength='255'  /><span class='mktFormMsg'></span></span>
				
				<input id='mktFrmSubmit' type='submit' class='btn' style="width: auto; overflow: visible; padding-left: .25em; padding-right: .25em;" value='Subscribe' name='submitButton' onclick='formSubmit(document.getElementById("mktForm_1013")); return false;' />
				
				<input style='display: none;' id='mktFrmReset' type='reset' value='Clear' name='resetButton' onclick='formReset(document.getElementById("mktForm_1013")); return false;' />
	
				<span style="display:none;"><input type="text" name="_marketo_comments" value="" /></span>
				<input type="hidden" name="lpId" value="-1" />
				<input type="hidden" name="subId" value="100" />

				<input type="hidden" name="kw" value="" />
				<input type="hidden" name="cr" value="" />
				
				<input type="hidden" name="searchstr" value="" />
				<input type="hidden" name="lpurl" value="http://info.puppetlabs.com/testsubscription.html?cr={creative}&kw={keyword}"; />
				<input type="hidden" name="formid" value="1013" />
				<input type="hidden" name="returnURL" value="http://www.puppetlabs.com/misc/subscription-thank-you/"; />
				<input type="hidden" name="retURL" value="http://www.puppetlabs.com/misc/subscription-thank-you/"; />
				<input type="hidden" name="_mkt_disp" value="return" />
				<input type="hidden" name="_mkt_trk" value="" />

				</form>
				<script type="text/javascript" src="http://info.puppetlabs.com/js/mktFormSupport.js"></script>
				
				<script type="text/javascript">
				function formSubmit(elt) {
				return Mkto.formSubmit(elt);
				}
				function formReset(elt) {
				return Mkto.formReset(elt);
				}
				</script>
              
<a href="http://info.puppetlabs.com/puppet-enterprise" class="fbtn">Try Puppet Enterprise FREE</a>

            </section>
            <section id="elsewhere">
              <h4>Get Involved</h4>
              <ul>

                <li class="chat"><a href="http://webchat.freenode.net/?channels=puppet" rel="external"><span class="indicator"></span><span>Chat with us on IRC</span></a></li>
		<li class="discussion"><a href="http://groups.google.com/group/puppet-dev" rel="external"><span class="indicator"></span><span>Join the Puppet Developer List</span></a></li>
                <li class="discussion"><a href="http://groups.google.com/group/puppet-users?pli=1" rel="external"><span class="indicator"></span><span>Join the Puppet User List</span></a></li>
                
                <li class="linkedin"><a href="http://www.linkedin.com/groups?about=&gid=696467&trk=anet_ug_grppro" rel="external"><span class="indicator"></span><span>Join the Puppet Users LinkedIn group</span></a></li>	

              </ul>
		<p>
		              		<h4>Follow us&#8230;</h4>

              		<ul class="followus">

					
			<li><a href="http://feeds.feedburner.com/PuppetLabs" target="_blank"><img src="http://www.puppetlabs.com/wp-content/plugins/my-profiles/images/rss.png" border="0"></a></li>
			<li><a href="http://www.facebook.com/pages/Puppet-Labs/219089920711" target="_blank"><img src="http://www.puppetlabs.com//wp-content/plugins/my-profiles/images/facebook.png" border="0"></a></li>
			<li><a href="http://www.twitter.com/puppetlabs" target="_blank"><img src="http://www.puppetlabs.com//wp-content/plugins/my-profiles/images/twitter.png" border="0"></a></li>
			<li><a href="http://www.linkedin.com/groups?about=&amp;gid=696467&amp;trk=anet_ug_grppro" target="_blank"><img src="http://www.puppetlabs.com//wp-content/uploads/2011/01/LinkedIn_IN_Icon_32px.png" border="0"></a></li>    <li><a href="https://github.com/puppetlabs" target="_blank"><img src="http://www.puppetlabs.com//wp-content/uploads/2011/01/github_icon.png" border="0"></a></li>
					</ul>

              	</p>

            </section>
          </div>
          <div class="secondary-content">
            <section id="book-it">
              <h4>Get the book!</h4>

              <p>Written by James Turnbull and Jeff McCune, <a href="http://www.apress.com/9781430230571" rel="nofollow">Pro Puppet</a> is a comprehensive and up-to-date look at Puppet and MCollective. </p>
              <a href="http://www.apress.com/9781430230571" rel="nofollow"><img src="http://www.puppetlabs.com/wp-content/uploads/2011/05/propuppetthumb.png" /></a>
            </section>
          </div>
        </div>
      </div>
		</footer>

    <div id="copyright">
      <div class="site-width">
        &copy; 2011 <a href="http://www.puppetlabs.com/" title="Puppet Labs">Puppet Labs</a>
        <span class="vcard">
         <span class="org"></span>
         <a class="email" href="mailto:info@puppetlabs.com">info@puppetlabs.com</a>

          <span class="adr">
           <span class="street-address">411 NW Park Avenue</span>
           /
           <span class="locality">Portland</span>, 
           <span class="region">OR</span>
           <span class="postal-code">97209</span>

          </span>

         <span class="tel">1-877-575-9775</span>
        </span>          
      </div>
    </div>
    <script src="http://munchkin.marketo.net/munchkin.js" type="text/javascript"></script> <script>mktoMunchkin("307-QLA-991");</script> 
    
  	<script type="text/javascript">Cufon.now();</script>
  	<style type="text/css">h1, h2, .btn { visibility : visible; }</style>

	</body>
</html>        
