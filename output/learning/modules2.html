<!DOCTYPE html>
<html dir="ltr" lang="en-US">
  <head>
  	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  	<title>Documentation | Puppet Labs - Learning — Modules 2</title>
  	<meta name="description" content="The open source leader in data center automation">
  	<link rel="alternate" type="text/xml" title="Puppet Labs RSS 0.92 Feed" href="http://puppetlabs.com/feed/rss/">
  	<link rel="alternate" type="application/atom+xml" title="Puppet Labs Atom Feed" href="http://puppetlabs.com/feed/atom/">
  	<link rel="alternate" type="application/rss+xml" title="Puppet Labs RSS 2.0 Feed" href="http://puppetlabs.com/feed/">
  	<link rel="pingback" href="http://puppetlabs.com/xmlrpc.php">
    <link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://puppetlabs.com/xmlrpc.php?rsd" />
    <link rel='index' title='Puppet Labs' href='http://docs.puppetlabs.com' />

<!-- Google stats -->
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-1537572-5");
pageTracker._setDomainName(".puppetlabs.com");
pageTracker._trackPageview();
} catch(err) {}</script>
<!-- End Google stats -->


    <!-- FIXME: absolute paths -->

    <script type='text/javascript' src='/files/javascripts/html5.js'></script>
    <script type='text/javascript' src='/files/javascripts/jquery-1.3.2.min.js'></script>
    <script type='text/javascript' src='/files/javascripts/drop_down.js'></script>
    <script type='text/javascript' src='/files/javascripts/cufon-yui.js'></script>
    <script type='text/javascript' src='/files/fonts/Klavika_400-Klavika_600.font.js'></script>
    <script type='text/javascript' src='/files/javascripts/ampersands.js'></script>

     <!--Add rotation jQuery Script -->
	 	
    <script type='text/javascript' src='/files/javascripts/addRotate.js'></script>

    <!-- All in One SEO Pack 1.6.10.1 by Michael Torbert of Semper Fi Web Design[127,146] -->
    <meta name="keywords" content="Puppet, puppet labs, reductive labs, open source, system administrator, ruby, data center, automation, support" />
    <link rel="canonical" href="http://docs.puppetlabs.com" />
    <!-- /all in one seo pack -->
	
    <!-- FIXME: absolute paths -->

    <link rel="stylesheet" type="text/css" href="/files/stylesheets/style.css" media="screen"> 
    <link rel="stylesheet" type="text/css" href="/files/stylesheets/syntax.css" media="screen"> <!-- index -->
    <link rel="stylesheet" type="text/css" href="/files/stylesheets/adbanner.css" media="screen">

    <!--[if IE 7]>
	  <link rel="stylesheet" type="text/css" href="/files/stylesheets/ie_7.css" media="screen"> <!-- index -->
    <![endif]-->
  
    <!--[if IE 8]>
	    <link rel="stylesheet" type="text/css" href="/files/stylesheets/ie_8.css" media="screen"> <!-- index -->
    <![endif]-->		

  	<script type="text/javascript">
      Cufon.replace('h1, h2', { fontWeight: '600' });
  	</script>
</head>



        
  <body id="puppetlabsdocs" class="docs">
  <style type="text/css">h1, h2{ visibility : hidden }</style>		
  <!--[if IE 8]>
    <style type="text/css">h1, h2{ visibility : visible }</style>
  <![endif]-->		

  	<header id="header">
      <div class="site-width">
    		<h1><a href="http://puppetlabs.com/"><span>Puppet Labs</span></a></h1>
        <a class="screen-reader-content" href="#content">Skip navigation</a>
        <nav>
    		<ul id="global-navigation">
          <li id="puppet-tab" class="with-submenu">
            <a href="http://www.puppetlabs.com/puppet/">
              <span>Products</span>

              <span class="drop-down-trigger"></span>
            </a>
            <ul>            
              <li>
                <ul>
<li class="page_item page-item-769"><a href="http://www.puppetlabs.com/puppet/puppet-enterprise/" title="Puppet Enterprise">Puppet Enterprise</a></li>
<li class="page_item page-item-757"><a href="http://www.puppetlabs.com/puppet/introduction/" title="Puppet">Puppet</a></li>
<li class="page_item page-item-956"><a href="http://www.puppetlabs.com/puppet/how-to-buy/" title="How to Buy">How to Buy</a></li>
<li class="page_item page-item-1159"><a href="http://forge.puppetlabs.com/" title="Module Forge">Module Forge</a></li>

<li class="page_item page-item-2415"><a href="http://www.puppetlabs.com/mcollective/introduction/" title="MCollective">MCollective</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li id="services-tab" class="with-submenu">
            <a href="http://www.puppetlabs.com/services/">
              <span>Services</span>
              <span class="drop-down-trigger"></span>

            </a>
            <ul>
              <li class="page_item page-item-783"><a href="http://www.puppetlabs.com/services/overview/" title="Overview">Overview</a></li>
<li class="page_item page-item-839"><a href="http://www.puppetlabs.com/services/support/" title="Enterprise Support">Enterprise Support</a></li>
<li class="page_item page-item-845"><a href="http://www.puppetlabs.com/services/training-workshops/" title="On-Site Training &amp; Consulting">On-Site Training &amp; Consulting</a></li>
<li class="page_item page-item-849"><a href="/category/events/upcoming/" title="Events &amp; Public Training">Events &amp; Public Training</a></li>
<li class="page_item page-item-851"><a href="http://www.puppetlabs.com/services/partners/" title="Partners">Partners</a></li>
<li class="page_item page-item-1037"><a href="/resources/customer-support" title="Customer Support">Customer Support</a></li>
            </ul>
          </li>
          <li id="resources-tab" class="with-submenu">
            <a href="http://www.puppetlabs.com/resources/">
              <span>Resources</span>

              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-1048"><a href="http://www.puppetlabs.com/resources/overview-2/" title="Overview">Overview</a></li>
<li class="page_item page-item-1052"><a href="http://www.puppetlabs.com/resources/customer-support/" title="Customer Support">Customer Support</a></li>
<li class="page_item page-item-1040"><a href="http://docs.puppetlabs.com" title="Documentation">Documentation</a></li>
<li class="page_item page-item-872"><a href="http://info.puppetlabs.com/register-download" title="Downloads">Downloads</a></li>
<li class="page_item page-item-1961"><a href="http://forge.puppetlabs.com" title="Module Forge">Module Forge</a></li>
<li class="page_item page-item-835"><a href="http://info.puppetlabs.com/request-whitepapers.html" title="White Papers">White Papers</a></li>
<li class="page_item page-item-1967"><a href="http://projects.puppetlabs.com/projects/puppet/wiki" title="Wiki">Wiki</a></li>
            </ul>

          </li>

<li id="customer-tab" class="with-submenu">
            <a href="http://www.puppetlabs.com/customers/companies/">
              <span>Customers</span>

              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-1048"><a href="http://www.puppetlabs.com/customers/companies/" title="Overview">Companies</a></li>
<li class="page_item page-item-1052"><a href="http://www.puppetlabs.com/customers/case-studies/" title="Case Studies">Case Studies</a></li>
<li class="page_item page-item-1040"><a href="http://www.puppetlabs.com/customers/product-testimonials/" title="Product Testimonials">Product Testimonials</a></li>
<li class="page_item page-item-872"><a href="http://www.puppetlabs.com/customers/what-customers-are-saying/" title="ervice Testimonials">Service Testimonials</a></li>
	</ul>
          </li>
         <li id="community-tab" class="with-submenu">
            <a href="http://www.puppetlabs.com/community/">
              <span>Community</span>

              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-2195"><a href="http://www.puppetlabs.com/community/overview/" title="Overview">Overview</a></li>
<li class="page_item page-item-2195"><a href="http://www.puppetlabs.com/blog" title="Blog">Blog</a></li>
<li class="page_item page-item-2264"><a href="http://www.puppetlabs.com/community/puppet-camp/" title="Puppet Camp">Puppet Camp</a></li>
<li class="page_item page-item-2249"><a href="http://www.puppetlabs.com/community/user-groups-and-devops-groups/" title="User Groups &amp; DevOps Groups">User Groups &amp; DevOps Groups</a></li>
<li class="page_item page-item-2215"><a href="http://www.puppetlabs.com/community/presentations/" title="Presentations">Presentations</a></li>

<li class="page_item page-item-2217"><a href="http://www.puppetlabs.com/community/videos/" title="Videos">Videos</a></li>
<li class="page_item page-item-2217"><a href="http://www.puppetlabs.com/community/badges/" title="Badges">Badges</a></li>
            </ul>
          </li>

          <li id="company-tab" class="with-submenu">
            <a href="http://www.puppetlabs.com/company/">
              <span>Company</span>
              <span class="drop-down-trigger"></span>
            </a>

            <ul>
              <li class="page_item page-item-2316"><a href="http://www.puppetlabs.com/company/overview/" title="Overview">Overview</a></li>
<li class="page_item page-item-2179"><a href="http://www.puppetlabs.com/company/news/" title="News">News</a></li>
<li class="page_item page-item-1571"><a href="http://www.puppetlabs.com/company/jobs/" title="Jobs">Jobs</a></li>
<li class="page_item page-item-2313"><a href="http://www.puppetlabs.com/company/contact-us/" title="Contact Us">Contact Us</a></li>
            </ul>
          </li>
    		</ul>	   
          <div id="misc-navigation">

			  <ul>
				<li><a href="http://docs.puppetlabs.com">Documentation</a></li>
				<li><a href="http://puppetlabs.com/resources/customer-support/">Support</a></li>
				<li><a href="http://projects.puppetlabs.com/">Bug Tracker</a></li>
				<li><a href="http://puppetlabs.com/company/#contact">Contact Us</a></li>
				<li><a href="http://puppetlabs.com/resources/downloads" class="gateway">Download</a></li>
			  </ul>
			<form action="http://www.google.com/cse" id="cse-search-box">

			  <div>
				<input type="hidden" name="cx" value="017884045025332504017:1mnj-dlgfcc" />
				<input type="hidden" name="ie" value="UTF-8" />
				<input type="text" name="q" size="31" />
				<input type="submit" name="sa" class="searchbtn" value="Search" />
			  </div>
			</form>
			<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en"></script>

          </div>
      </nav>
    	</div>
    </header>  

      <section id="masthead">
        <div class="site-width">
          <h1>Docs: <span class="section-name">Learning — Modules 2</span></h1>
          <ul id="doc-navigation">
            <li><a href="/">Docs Home</a></li>
            <li class="with-submenu">
              <a href="#">
                <span>Quick Nav</span>
                <span class="drop-down-trigger"></span>
              </a>
               <!-- the following links can't be relative, unfortunately -->
               <!-- future: add some JS to disable this if running from file:// -->
               	            <dl>
	              <dt>Puppet Guides</dt>
                      <dd><a href="/index.html">Index</a></dd>
                  <dt>Puppet References</dt>
                      <dd><a href="/references/stable/type.html">Resource Types</a></dd>
                      <dd><a href="/references/stable/function.html">Functions</a></dd>
                      <dd><a href="/references/stable/metaparameter.html">Metaparameters</a></dd>
                      <dd><a href="/references/stable/configuration.html">Configuration</a></dd>
                      <dt>References By Version</dt>
                      <dd><a href="/references/2.7.3/">2.7.3</a></dd>
                      <dd><a href="/references/2.6.9/">2.6.9</a></dd>
                      <dd><a href="/references/0.25.5/">0.25.5</a></dd>
                      <dd><a href="/references/0.24.8/">0.24.8</a></dd>
                      <dd><a href="/references/">Other Versions</a></dd>
                  <dt>MCollective</dt>
                      <dd><a href="/mcollective/index.html">Index</a></dd>
                      <dd><a href="/mcollective/simplerpc/index.html">SimpleRPC</a></dd>
                      <dd><a href="/mcollective/roadmap/index.html">Roadmap</a></dd>
                      <dd><a href="/mcollective/releasenotes.html">Release Notes</a></dd>
                      <dd><a href="/mcollective/reference/index.html">References</a></dd>
	            </dl>

            </li>
            <li><a href="/contribute.html">Contribute</a></li>
          </ul>
        </div>
      </section>
    
      <section id="content">
        <div class="site-width">
          <div class="primary-secondary-content">
            <div class="primary-content">
              <h1 id="learning--modules-and-parameterized-classes-part-two">Learning — Modules and (Parameterized) Classes (Part Two)</h1>

<p>Now that you have basic classes and modules under control, it&rsquo;s time for some more advanced code re-use. </p>

<hr />

<p>&larr; <a href="./templates.html">Templates</a> &mdash; <a href="./">Index</a> &mdash; TBA &rarr;</p>

<hr />

<h2 id="investigating-vs-passing-data">Investigating vs. Passing Data</h2>

<p>Most classes have to do slightly different things on different systems. You already know some ways to do that &mdash; all of the modules you&rsquo;ve written so far have switched their behaviors by looking up system facts. Let&rsquo;s say that they &ldquo;investigate:&rdquo; they expect some information to be in a specific place (in the case of facts, a top-scope variable), and go looking for it when they need it. </p>

<p>But this isn&rsquo;t always the best way to do it, and it starts to break down once you need to switch a module&rsquo;s behavior on information that doesn&rsquo;t map cleanly to system facts. Is this a database server? A local NTP server? </p>

<p>You could still have your modules investigate; instead of looking at the standard set of system facts, you could just point them to an arbitrary variable and make sure it&rsquo;s filled if you plan on using that class. But it might be better to just tell the class what it needs to know when you declare it. </p>

<h2 id="parameters">Parameters</h2>

<p>When defining a class, you can give it a list of <strong>parameters.</strong> </p>

<div class="highlight"><pre><code class="ruby">    <span class="k">class</span> <span class="n">mysql</span> <span class="p">(</span><span class="vg">$user</span><span class="p">,</span> <span class="vg">$port</span><span class="p">)</span> <span class="p">{</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="p">}</span>
</code></pre>
</div>

<p>This is a doorway for passing information into the class. When you declare the class, those parameters appear as <strong>resource attributes;</strong> inside the definition, they appear as <strong>local variables.</strong></p>

<div class="highlight"><pre><code class="ruby">    <span class="c1"># /etc/puppetlabs/puppet/modules/paramclassexample/manifests/init.pp</span>
    <span class="k">class</span> <span class="n">paramclassexample</span> <span class="p">(</span><span class="vg">$value1</span><span class="p">,</span> <span class="vg">$value2</span> <span class="o">=</span> <span class="s2">&quot;Default value&quot;</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">notify</span> <span class="p">{</span><span class="s2">&quot;Value 1 is ${value1}.&quot;</span><span class="p">:}</span>
      <span class="n">notify</span> <span class="p">{</span><span class="s2">&quot;Value 2 is ${value2}.&quot;</span><span class="p">:}</span>
    <span class="p">}</span>
    
    <span class="c1"># ~/learning-manifests/paramclass1.pp</span>
    <span class="k">class</span> <span class="p">{</span><span class="s1">&#39;paramclassexample&#39;</span><span class="p">:</span>
      <span class="n">value1</span> <span class="o">=&gt;</span> <span class="s1">&#39;Something&#39;</span><span class="p">,</span>
      <span class="n">value2</span> <span class="o">=&gt;</span> <span class="s1">&#39;Something else&#39;</span><span class="p">,</span>
    <span class="p">}</span>
    
    <span class="c1"># ~/learning-manifests/paramclass2.pp</span>
    <span class="k">class</span> <span class="p">{</span><span class="s1">&#39;paramclassexample&#39;</span><span class="p">:</span>
      <span class="n">value1</span> <span class="o">=&gt;</span> <span class="s1">&#39;Something&#39;</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre>
</div>

<pre><code># puppet apply ~/learning-manifests/paramclass1.pp
notice: Value 2 is Something else.
notice: /Stage[main]/Paramclassexample/Notify[Value 2 is Something else.]/message: defined 'message' as 'Value 2 is Something else.'
notice: Value 1 is Something.
notice: /Stage[main]/Paramclassexample/Notify[Value 1 is Something.]/message: defined 'message' as 'Value 1 is Something.'
notice: Finished catalog run in 0.05 seconds

# puppet apply ~/learning-manifests/paramclass2.pp
notice: Value 1 is Something.
notice: /Stage[main]/Paramclassexample/Notify[Value 1 is Something.]/message: defined 'message' as 'Value 1 is Something.'
notice: Value 2 is Default value.
notice: /Stage[main]/Paramclassexample/Notify[Value 2 is Default value.]/message: defined 'message' as 'Value 2 is Default value.'
notice: Finished catalog run in 0.05 seconds
</code></pre>

<p>(As shown above, you can give any parameter a default value, which makes it optional when you declare the class. Parameters without defaults are required.)</p>

<p>So what&rsquo;s the benefit of all this? In a word, it <a href="http://en.wikipedia.org/wiki/Information_hiding#Encapsulation">encapsulates</a> the class. You don&rsquo;t have to pick unique magic variable names to use as a dead drop, and since anything affecting the function of the class has to pass through the parameters, it&rsquo;s much more clear <em>where</em> the information is coming from. This pays off once you start having to think about how modules work with other modules, and it <em>really</em> pays off if you want to download or create reusable modules. </p>

<h2 id="example-ntp-again">Example: NTP (Again)</h2>

<p>So let&rsquo;s get back to our NTP module. The first thing we talked about wanting to vary was the set of servers, and we already did the heavy lifting back in the <a href="./templates.html">templates</a> chapter, so that&rsquo;s a good place to start: </p>

<div class="highlight"><pre><code class="ruby">    <span class="k">class</span> <span class="n">ntp</span> <span class="p">(</span><span class="vg">$servers</span> <span class="o">=</span> <span class="k">undef</span><span class="p">)</span> <span class="p">{</span>
      <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</code></pre>
</div>

<p>And&hellip; that&rsquo;s all it takes, actually. This will work. If you declare the class with no attributes&hellip;</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">class</span> <span class="p">{</span><span class="s1">&#39;ntp&#39;</span><span class="p">:}</span>
</code></pre>
</div>

<p>&hellip;it&rsquo;ll work the same way it used to. If you declare it with a <code>servers</code> attribute containing an array of servers (with or without appended <code>iburst</code> and <code>dynamic</code> statements)&hellip;</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">class</span> <span class="p">{</span><span class="s1">&#39;ntp&#39;</span><span class="p">:</span>
      <span class="n">servers</span> <span class="o">=&gt;</span> <span class="o">[</span> <span class="s2">&quot;ntp1.puppetlabs.lan dynamic&quot;</span><span class="p">,</span> <span class="s2">&quot;ntp2.puppetlabs.lan dynamic&quot;</span><span class="p">,</span> <span class="o">]</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>&hellip;it&rsquo;ll override the servers in the <code>ntp.conf</code> file. Nice.</p>

<p>There <em>is</em> a bit of trickery to notice: setting a variable or parameter to <code>undef</code> might seem odd, and we&rsquo;re only doing it because we want to be able to get the default servers without asking for them. (Remember, parameters can&rsquo;t be optional without an explicit default value.) </p>

<p>Also, remember the business with the <code>$servers_real</code> variable? That was because the Puppet language won&rsquo;t let us re-assign the <code>$servers</code> variable within a given scope. If the default value we wanted was the same regardless of OS, we could just use it as the parameter default, but the extra logic to accomodate the per-OS defaults means we have to make a copy.</p>

<p>While we&rsquo;re in the NTP module, what else could we make into a parameter? Well, let&rsquo;s say you have a mixed environment of physical and virtual machines, and some of them occasionally make the transition between VM and metal. Since NTP behaves weirdly under virtualization, you&rsquo;d want it turned off on your virtual machines &mdash; and you would have to manage the service as a resource to do that, because if you just didn&rsquo;t say anything about NTP (by not declaring the class, e.g.), it might actually still be running. So you could make a separate <code>ntp_disabled</code> class and declare it whenever you aren&rsquo;t declaring the <code>ntp</code> class&hellip; but it makes more sense to expose the service&rsquo;s attributes as class parameters. That way, when you move a formerly physical server into the cloud, you could just change that part of its manifests from this:</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">class</span> <span class="p">{</span><span class="s1">&#39;ntp&#39;</span><span class="p">:}</span>
</code></pre>
</div>

<p>&hellip;to this:</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">class</span> <span class="p">{</span><span class="s1">&#39;ntp&#39;</span><span class="p">:</span>
      <span class="k">ensure</span> <span class="o">=&gt;</span> <span class="n">stopped</span><span class="p">,</span>
      <span class="n">enable</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>And making that work right is almost as easy as the last edit. Here&rsquo;s the complete class, with all of our modifications thus far: </p>

<div class="highlight"><pre><code class="ruby">    <span class="c1">#/etc/puppetlabs/puppet/modules/ntp/manifests/init.pp</span>
    <span class="k">class</span> <span class="n">ntp</span> <span class="p">(</span><span class="vg">$servers</span> <span class="o">=</span> <span class="k">undef</span><span class="p">,</span> <span class="vg">$enable</span> <span class="o">=</span> <span class="kp">true</span><span class="p">,</span> <span class="vg">$ensure</span> <span class="o">=</span> <span class="n">running</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="vg">$operatingsystem</span> <span class="p">{</span>
        <span class="n">centos</span><span class="p">,</span> <span class="n">redhat</span><span class="p">:</span> <span class="p">{</span> 
          <span class="vg">$service_name</span>    <span class="o">=</span> <span class="s1">&#39;ntpd&#39;</span>
          <span class="vg">$conf_template</span>   <span class="o">=</span> <span class="s1">&#39;ntp.conf.el.erb&#39;</span>
          <span class="vg">$default_servers</span> <span class="o">=</span> <span class="o">[</span> <span class="s2">&quot;0.centos.pool.ntp.org&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;1.centos.pool.ntp.org&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;2.centos.pool.ntp.org&quot;</span><span class="p">,</span> <span class="o">]</span>
        <span class="p">}</span>
        <span class="n">debian</span><span class="p">,</span> <span class="n">ubuntu</span><span class="p">:</span> <span class="p">{</span> 
          <span class="vg">$service_name</span>    <span class="o">=</span> <span class="s1">&#39;ntp&#39;</span>
          <span class="vg">$conf_template</span>   <span class="o">=</span> <span class="s1">&#39;ntp.conf.debian.erb&#39;</span>
          <span class="vg">$default_servers</span> <span class="o">=</span> <span class="o">[</span> <span class="s2">&quot;0.debian.pool.ntp.org iburst&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;1.debian.pool.ntp.org iburst&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;2.debian.pool.ntp.org iburst&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;3.debian.pool.ntp.org iburst&quot;</span><span class="p">,</span> <span class="o">]</span>
        <span class="p">}</span>
      <span class="p">}</span>
      
      <span class="k">if</span> <span class="vg">$servers</span> <span class="o">==</span> <span class="k">undef</span> <span class="p">{</span>
        <span class="vg">$servers_real</span> <span class="o">=</span> <span class="vg">$default_servers</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="vg">$servers_real</span> <span class="o">=</span> <span class="vg">$servers</span>
      <span class="p">}</span>
      
      <span class="n">package</span> <span class="p">{</span> <span class="s1">&#39;ntp&#39;</span><span class="p">:</span>
        <span class="k">ensure</span> <span class="o">=&gt;</span> <span class="n">installed</span><span class="p">,</span>
      <span class="p">}</span>
      
      <span class="n">service</span> <span class="p">{</span> <span class="s1">&#39;ntp&#39;</span><span class="p">:</span>
        <span class="nb">name</span>      <span class="o">=&gt;</span> <span class="vg">$service_name</span><span class="p">,</span>
        <span class="k">ensure</span>    <span class="o">=&gt;</span> <span class="vg">$ensure</span><span class="p">,</span>
        <span class="n">enable</span>    <span class="o">=&gt;</span> <span class="vg">$enable</span><span class="p">,</span>
        <span class="n">subscribe</span> <span class="o">=&gt;</span> <span class="no">File</span><span class="o">[</span><span class="s1">&#39;ntp.conf&#39;</span><span class="o">]</span><span class="p">,</span>
      <span class="p">}</span>
      
      <span class="n">file</span> <span class="p">{</span> <span class="s1">&#39;ntp.conf&#39;</span><span class="p">:</span>
        <span class="n">path</span>    <span class="o">=&gt;</span> <span class="s1">&#39;/etc/ntp.conf&#39;</span><span class="p">,</span>
        <span class="k">ensure</span>  <span class="o">=&gt;</span> <span class="n">file</span><span class="p">,</span>
        <span class="nb">require</span> <span class="o">=&gt;</span> <span class="no">Package</span><span class="o">[</span><span class="s1">&#39;ntp&#39;</span><span class="o">]</span><span class="p">,</span>
        <span class="n">content</span> <span class="o">=&gt;</span> <span class="n">template</span><span class="p">(</span><span class="s2">&quot;ntp/${conf_template}&quot;</span><span class="p">),</span>
      <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>Is there anything else we could do to this class? Well, yes: its behavior under anything but Debian, Ubuntu, CentOS, or RHEL is currently undefined, so it&rsquo;d be nice to, say, come up with some config templates to use under the BSDs and OS X and then fail gracefully on unrecognized OSes. And it might make sense to unify our two current templates; they were just based on the system defaults, and once you decide how NTP should be configured at your site, chances are it&rsquo;s going to look similar on any Unix. This could also let you simplify the default value and get rid of that <code>undef</code> and <code>$servers_real</code> dance. But as it stands, this module is pretty serviceable. </p>

<p>So hey, let&rsquo;s throw on some documentation and be done with it! </p>

<h2 id="module-documentation">Module Documentation</h2>

<div class="highlight"><pre><code class="ruby">    <span class="c1"># Class: ntp</span>
    <span class="c1"># </span>
    <span class="c1"># This class installs/configures/manages NTP. It can optionally disable NTP</span>
    <span class="c1"># on virtual machines. Only supported on Debian-derived and Red Hat-derived OSes.</span>
    <span class="c1"># </span>
    <span class="c1"># Parameters: </span>
    <span class="c1">#   - $servers:</span>
    <span class="c1">#         An array of NTP servers, with or without +iburst+ and </span>
    <span class="c1">#         +dynamic+ statements appended. Defaults to the OS&#39;s defaults.</span>
    <span class="c1">#   - $enable:</span>
    <span class="c1">#         Whether to start the NTP service on boot. Defaults to true. Valid</span>
    <span class="c1">#         values: true and false. </span>
    <span class="c1">#   - $ensure:</span>
    <span class="c1">#         Whether to run the NTP service. Defaults to running. Valid values:</span>
    <span class="c1">#         running and stopped. </span>
    <span class="c1"># </span>
    <span class="c1"># Requires: </span>
    <span class="c1">#   Nothing.</span>
    <span class="c1"># </span>
    <span class="c1"># Sample Usage:</span>
    <span class="c1">#   class {&#39;ntp&#39;:</span>
    <span class="c1">#     servers =&gt; [ &quot;ntp1.puppetlabs.lan dynamic&quot;,</span>
    <span class="c1">#                  &quot;ntp2.puppetlabs.lan dynamic&quot;, ],</span>
    <span class="c1">#   }</span>
    <span class="c1">#   class {&#39;ntp&#39;:</span>
    <span class="c1">#     enable =&gt; false,</span>
    <span class="c1">#     ensure =&gt; stopped,</span>
    <span class="c1">#   }</span>
    <span class="c1">#</span>
    <span class="k">class</span> <span class="n">ntp</span> <span class="p">(</span><span class="vg">$servers</span> <span class="o">=</span> <span class="k">undef</span><span class="p">,</span> <span class="vg">$enable</span> <span class="o">=</span> <span class="kp">true</span><span class="p">,</span> <span class="vg">$ensure</span> <span class="o">=</span> <span class="n">running</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="vg">$operatingsystem</span> <span class="p">{</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span>
      <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</code></pre>
</div>

<p>This doesn&rsquo;t have to be Tolstoy, but seriously, at least write down what the parameters are and what kind of data they take. Your future self will thank you. Also! If you put it in a comment block butted up directly against the start of the class definition, you can automatically generate a browsable Rdoc-style site with info for all your modules. You can test it now, actually: </p>

<pre><code># puppet doc --mode rdoc --outputdir ~/moduledocs --modulepath /etc/puppetlabs/puppet/modules
</code></pre>

<p>(Then just upload that <code>~/moduledocs</code> folder to some webspace you control, or grab it onto your desktop with SFTP.)</p>

<h2 id="some-important-notes-from-the-dept-of-foreshadowing">Some Important Notes From the Dep&rsquo;t of Foreshadowing</h2>

<p>Parameterized classes are still pretty new &mdash; they were only added to Puppet in version 2.6.0 &mdash; and they changed the landscape of Puppet in some ways that aren&rsquo;t immediately obvious. </p>

<p>You probably noticed that the examples in this chapter are all using the <a href="http://docs.puppetlabs.com/learning/modules1.html#declaring">resource-like</a> declaration syntax instead of the <a href="http://docs.puppetlabs.com/learning/modules1.html#include">include</a> function. That&rsquo;s because <strong>include doesn&rsquo;t work</strong><sup id="fnref:alldefault"><a href="#fn:alldefault" rel="footnote">1</a></sup> with parameterized classes, and likely never will. The problem is that the whole point of <code>include</code> conflicts with the idea that a class can change depending on how it&rsquo;s declared &mdash; if you declare a class multiple times and the attributes don&rsquo;t match precisely, which set of attributes wins? </p>

<p>Parameterized classes made the problem with that paradigm more explicit, but it already existed, and it was possible to run afoul of it without even noticing. A common pattern for passing information into a class was to choose an external variable and have the class retrieve it with <a href="/guides/scope_and_puppet.html">dynamically-scoped variable lookup</a>.<sup id="fnref:scope"><a href="#fn:scope" rel="footnote">2</a></sup> If you were also having low-level classes manage their own dependencies by including anything they might need, then a given class might have several potential scope chains resolving to different values, which would result in a race &mdash; whichever <code>include</code> took effect first would determine the behavior of the class. </p>

<p>However, there were and are a couple of other ways to get data into a class &mdash; let&rsquo;s lump them together and call them <strong>data separation</strong> &mdash; and if you used them well, your classes could safely manage their own dependencies with include. Using parameterized classes gives you new options for site design that we&rsquo;ve come to believe are just plain better, but it closes off that option of self-managed dependencies. </p>

<p>I&rsquo;m purposely getting ahead of myself a bit &mdash; this isn&rsquo;t going to be fully relevant until we start talking about class composition and site design, and we&rsquo;ll be covering data separation later as well. But since all these issues stem from ideas about what a class is and where it gets its information, it seemed worthwhile to mention some of these issues now, just so they don&rsquo;t seem so out-of-the-blue later.</p>

<h2 id="next">Next</h2>

<p>Okay, we can pass parameters into classes now and change their behavior. Great! But classes are still always singletons; you can&rsquo;t declare more than one copy and get two different sets of behavior simultaneously. And you&rsquo;ll eventually want to do that! What if you had a collection of resources that created a vhost definition for a web server, or cloned a Git repository, or managed a user account complete with group, SSH key, home directory contents, sudoers entry, and .bashrc/.vimrc/etc. files? What if you wanted more than one Git repo, user account, or vhost on a single machine?</p>

<p>Well, you&rsquo;d whip up a defined resource type. Come back soon for Modules (part three)!</p>
<div class="footnotes">
  <ol>
    <li id="fn:alldefault">
      <p>Yes, you can actually <code>include</code> a parameterized class if all of its parameters have defaults, but mixing and matching declaration styles for a class is not the best plan.<a href="#fnref:alldefault" rev="footnote">&#8617;</a></p>
    </li>
    <li id="fn:scope">
      <p>I haven&rsquo;t covered dynamic scope in Learning Puppet, both because it shouldn&rsquo;t be necessary for someone learning today and because its days are numbered.<a href="#fnref:scope" rev="footnote">&#8617;</a></p>
    </li>
  </ol>
</div>

            </div>
            <div class="secondary-content">
                  <div id="subCol">
                  
                  
                      <h3 class="chapter">Contents</h3>
                      
<ol class="toc">
  <li class="toc-lv2"><a href="#investigating-vs-passing-data">Investigating vs. Passing Data</a></li>
  <li class="toc-lv2"><a href="#parameters">Parameters</a></li>
  <li class="toc-lv2"><a href="#example-ntp-again">Example: NTP (Again)</a></li>
  <li class="toc-lv2"><a href="#module-documentation">Module Documentation</a></li>
  <li class="toc-lv2"><a href="#some-important-notes-from-the-dept-of-foreshadowing">Some Important Notes From the Dep&rsquo;t of Foreshadowing</a></li>
  <li class="toc-lv2"><a href="#next">Next</a></li>
</ol>
                  
                                        <!-- New Ads are inserted here -->
		  			<div id="bannerImage" style="display:block;">&nbsp;</div>
		  			<!-- Remove me on September 24 --><a href="http://bit.ly/puppetconf"><img src="http://www.puppetlabs.com/wp-content/uploads/2011/07/120x600_puppetconf.png" style="display:block; margin-left: auto; margin-right: auto;"></a>
                  </div>
            </div>
          </div>
        </div>
      </section>

		<footer id="footer">
      <div class="site-width">

        <div class="primary-secondary-content">
          <div class="primary-content">
            <section id="newsletter">
                 <h4>Puppet Labs is Hiring</h4>
                 <p><a href="http://www.puppetlabs.com/company/jobs/">Engineers, developers & consultants</a>
                  <p>  
		<h4>Newsletter</h4>

              <p>Stay up to date on all things puppet</p>
              
				<form class="lpeRegForm formNotEmpty" method="post" enctype="application/x-www-form-urlencoded" action="http://info.puppetlabs.com/index.php/leadCapture/save"; id="mktForm_1013" name="mktForm_1013">
				
				<label>Email Address:</label><span class='mktInput'><input class='mktFormText mktFormEmail' name="Email" id="Email" type='text' value="" maxlength='255'  /><span class='mktFormMsg'></span></span>
				
				<input id='mktFrmSubmit' type='submit' class='btn' style="width: auto; overflow: visible; padding-left: .25em; padding-right: .25em;" value='Subscribe' name='submitButton' onclick='formSubmit(document.getElementById("mktForm_1013")); return false;' />
				
				<input style='display: none;' id='mktFrmReset' type='reset' value='Clear' name='resetButton' onclick='formReset(document.getElementById("mktForm_1013")); return false;' />
	
				<span style="display:none;"><input type="text" name="_marketo_comments" value="" /></span>
				<input type="hidden" name="lpId" value="-1" />
				<input type="hidden" name="subId" value="100" />

				<input type="hidden" name="kw" value="" />
				<input type="hidden" name="cr" value="" />
				
				<input type="hidden" name="searchstr" value="" />
				<input type="hidden" name="lpurl" value="http://info.puppetlabs.com/testsubscription.html?cr={creative}&kw={keyword}"; />
				<input type="hidden" name="formid" value="1013" />
				<input type="hidden" name="returnURL" value="http://www.puppetlabs.com/misc/subscription-thank-you/"; />
				<input type="hidden" name="retURL" value="http://www.puppetlabs.com/misc/subscription-thank-you/"; />
				<input type="hidden" name="_mkt_disp" value="return" />
				<input type="hidden" name="_mkt_trk" value="" />

				</form>
				<script type="text/javascript" src="http://info.puppetlabs.com/js/mktFormSupport.js"></script>
				
				<script type="text/javascript">
				function formSubmit(elt) {
				return Mkto.formSubmit(elt);
				}
				function formReset(elt) {
				return Mkto.formReset(elt);
				}
				</script>
              
<a href="http://info.puppetlabs.com/puppet-enterprise" class="fbtn">Try Puppet Enterprise FREE</a>

            </section>
            <section id="elsewhere">
              <h4>Get Involved</h4>
              <ul>

                <li class="chat"><a href="http://webchat.freenode.net/?channels=puppet" rel="external"><span class="indicator"></span><span>Chat with us on IRC</span></a></li>
		<li class="discussion"><a href="http://groups.google.com/group/puppet-dev" rel="external"><span class="indicator"></span><span>Join the Puppet Developer List</span></a></li>
                <li class="discussion"><a href="http://groups.google.com/group/puppet-users?pli=1" rel="external"><span class="indicator"></span><span>Join the Puppet User List</span></a></li>
                
                <li class="linkedin"><a href="http://www.linkedin.com/groups?about=&gid=696467&trk=anet_ug_grppro" rel="external"><span class="indicator"></span><span>Join the Puppet Users LinkedIn group</span></a></li>	

              </ul>
		<p>
		              		<h4>Follow us&#8230;</h4>

              		<ul class="followus">

					
			<li><a href="http://feeds.feedburner.com/PuppetLabs" target="_blank"><img src="http://www.puppetlabs.com/wp-content/plugins/my-profiles/images/rss.png" border="0"></a></li>
			<li><a href="http://www.facebook.com/pages/Puppet-Labs/219089920711" target="_blank"><img src="http://www.puppetlabs.com//wp-content/plugins/my-profiles/images/facebook.png" border="0"></a></li>
			<li><a href="http://www.twitter.com/puppetlabs" target="_blank"><img src="http://www.puppetlabs.com//wp-content/plugins/my-profiles/images/twitter.png" border="0"></a></li>
			<li><a href="http://www.linkedin.com/groups?about=&amp;gid=696467&amp;trk=anet_ug_grppro" target="_blank"><img src="http://www.puppetlabs.com//wp-content/uploads/2011/01/LinkedIn_IN_Icon_32px.png" border="0"></a></li>    <li><a href="https://github.com/puppetlabs" target="_blank"><img src="http://www.puppetlabs.com//wp-content/uploads/2011/01/github_icon.png" border="0"></a></li>
					</ul>

              	</p>

            </section>
          </div>
          <div class="secondary-content">
            <section id="book-it">
              <h4>Get the book!</h4>

              <p>Written by James Turnbull and Jeff McCune, <a href="http://www.apress.com/9781430230571" rel="nofollow">Pro Puppet</a> is a comprehensive and up-to-date look at Puppet and MCollective. </p>
              <a href="http://www.apress.com/9781430230571" rel="nofollow"><img src="http://www.puppetlabs.com/wp-content/uploads/2011/05/propuppetthumb.png" /></a>
            </section>
          </div>
        </div>
      </div>
		</footer>

    <div id="copyright">
      <div class="site-width">
        &copy; 2011 <a href="http://www.puppetlabs.com/" title="Puppet Labs">Puppet Labs</a>
        <span class="vcard">
         <span class="org"></span>
         <a class="email" href="mailto:info@puppetlabs.com">info@puppetlabs.com</a>

          <span class="adr">
           <span class="street-address">411 NW Park Avenue</span>
           /
           <span class="locality">Portland</span>, 
           <span class="region">OR</span>
           <span class="postal-code">97209</span>

          </span>

         <span class="tel">1-877-575-9775</span>
        </span>          
      </div>
    </div>
    <script src="http://munchkin.marketo.net/munchkin.js" type="text/javascript"></script> <script>mktoMunchkin("307-QLA-991");</script> 
    
  	<script type="text/javascript">Cufon.now();</script>
  	<style type="text/css">h1, h2, .btn { visibility : visible; }</style>

	</body>
</html>        
