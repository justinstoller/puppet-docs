<!DOCTYPE html>
<html dir="ltr" lang="en-US">
  <head>
  	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  	<title>Documentation | Puppet Labs - Learning — Templates</title>
  	<meta name="description" content="The open source leader in data center automation">
  	<link rel="alternate" type="text/xml" title="Puppet Labs RSS 0.92 Feed" href="http://puppetlabs.com/feed/rss/">
  	<link rel="alternate" type="application/atom+xml" title="Puppet Labs Atom Feed" href="http://puppetlabs.com/feed/atom/">
  	<link rel="alternate" type="application/rss+xml" title="Puppet Labs RSS 2.0 Feed" href="http://puppetlabs.com/feed/">
  	<link rel="pingback" href="http://puppetlabs.com/xmlrpc.php">
    <link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://puppetlabs.com/xmlrpc.php?rsd" />
    <link rel='index' title='Puppet Labs' href='http://docs.puppetlabs.com' />

<!-- Google stats -->
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-1537572-5");
pageTracker._setDomainName(".puppetlabs.com");
pageTracker._trackPageview();
} catch(err) {}</script>
<!-- End Google stats -->


    <!-- FIXME: absolute paths -->

    <script type='text/javascript' src='/files/javascripts/html5.js'></script>
    <script type='text/javascript' src='/files/javascripts/jquery-1.3.2.min.js'></script>
    <script type='text/javascript' src='/files/javascripts/drop_down.js'></script>
    <script type='text/javascript' src='/files/javascripts/cufon-yui.js'></script>
    <script type='text/javascript' src='/files/fonts/Klavika_400-Klavika_600.font.js'></script>
    <script type='text/javascript' src='/files/javascripts/ampersands.js'></script>

     <!--Add rotation jQuery Script -->
	 	
    <script type='text/javascript' src='/files/javascripts/addRotate.js'></script>

    <!-- All in One SEO Pack 1.6.10.1 by Michael Torbert of Semper Fi Web Design[127,146] -->
    <meta name="keywords" content="Puppet, puppet labs, reductive labs, open source, system administrator, ruby, data center, automation, support" />
    <link rel="canonical" href="http://docs.puppetlabs.com" />
    <!-- /all in one seo pack -->
	
    <!-- FIXME: absolute paths -->

    <link rel="stylesheet" type="text/css" href="/files/stylesheets/style.css" media="screen"> 
    <link rel="stylesheet" type="text/css" href="/files/stylesheets/syntax.css" media="screen"> <!-- index -->
    <link rel="stylesheet" type="text/css" href="/files/stylesheets/adbanner.css" media="screen">

    <!--[if IE 7]>
	  <link rel="stylesheet" type="text/css" href="/files/stylesheets/ie_7.css" media="screen"> <!-- index -->
    <![endif]-->
  
    <!--[if IE 8]>
	    <link rel="stylesheet" type="text/css" href="/files/stylesheets/ie_8.css" media="screen"> <!-- index -->
    <![endif]-->		

  	<script type="text/javascript">
      Cufon.replace('h1, h2', { fontWeight: '600' });
  	</script>
</head>



        
  <body id="puppetlabsdocs" class="docs">
  <style type="text/css">h1, h2{ visibility : hidden }</style>		
  <!--[if IE 8]>
    <style type="text/css">h1, h2{ visibility : visible }</style>
  <![endif]-->		

  	<header id="header">
      <div class="site-width">
    		<h1><a href="http://puppetlabs.com/"><span>Puppet Labs</span></a></h1>
        <a class="screen-reader-content" href="#content">Skip navigation</a>
        <nav>
    		<ul id="global-navigation">
          <li id="puppet-tab" class="with-submenu">
            <a href="http://www.puppetlabs.com/puppet/">
              <span>Products</span>

              <span class="drop-down-trigger"></span>
            </a>
            <ul>            
              <li>
                <ul>
<li class="page_item page-item-769"><a href="http://www.puppetlabs.com/puppet/puppet-enterprise/" title="Puppet Enterprise">Puppet Enterprise</a></li>
<li class="page_item page-item-757"><a href="http://www.puppetlabs.com/puppet/introduction/" title="Puppet">Puppet</a></li>
<li class="page_item page-item-956"><a href="http://www.puppetlabs.com/puppet/how-to-buy/" title="How to Buy">How to Buy</a></li>
<li class="page_item page-item-1159"><a href="http://forge.puppetlabs.com/" title="Module Forge">Module Forge</a></li>

<li class="page_item page-item-2415"><a href="http://www.puppetlabs.com/mcollective/introduction/" title="MCollective">MCollective</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li id="services-tab" class="with-submenu">
            <a href="http://www.puppetlabs.com/services/">
              <span>Services</span>
              <span class="drop-down-trigger"></span>

            </a>
            <ul>
              <li class="page_item page-item-783"><a href="http://www.puppetlabs.com/services/overview/" title="Overview">Overview</a></li>
<li class="page_item page-item-839"><a href="http://www.puppetlabs.com/services/support/" title="Enterprise Support">Enterprise Support</a></li>
<li class="page_item page-item-845"><a href="http://www.puppetlabs.com/services/training-workshops/" title="On-Site Training &amp; Consulting">On-Site Training &amp; Consulting</a></li>
<li class="page_item page-item-849"><a href="/category/events/upcoming/" title="Events &amp; Public Training">Events &amp; Public Training</a></li>
<li class="page_item page-item-851"><a href="http://www.puppetlabs.com/services/partners/" title="Partners">Partners</a></li>
<li class="page_item page-item-1037"><a href="/resources/customer-support" title="Customer Support">Customer Support</a></li>
            </ul>
          </li>
          <li id="resources-tab" class="with-submenu">
            <a href="http://www.puppetlabs.com/resources/">
              <span>Resources</span>

              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-1048"><a href="http://www.puppetlabs.com/resources/overview-2/" title="Overview">Overview</a></li>
<li class="page_item page-item-1052"><a href="http://www.puppetlabs.com/resources/customer-support/" title="Customer Support">Customer Support</a></li>
<li class="page_item page-item-1040"><a href="http://docs.puppetlabs.com" title="Documentation">Documentation</a></li>
<li class="page_item page-item-872"><a href="http://info.puppetlabs.com/register-download" title="Downloads">Downloads</a></li>
<li class="page_item page-item-1961"><a href="http://forge.puppetlabs.com" title="Module Forge">Module Forge</a></li>
<li class="page_item page-item-835"><a href="http://info.puppetlabs.com/request-whitepapers.html" title="White Papers">White Papers</a></li>
<li class="page_item page-item-1967"><a href="http://projects.puppetlabs.com/projects/puppet/wiki" title="Wiki">Wiki</a></li>
            </ul>

          </li>

<li id="customer-tab" class="with-submenu">
            <a href="http://www.puppetlabs.com/customers/companies/">
              <span>Customers</span>

              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-1048"><a href="http://www.puppetlabs.com/customers/companies/" title="Overview">Companies</a></li>
<li class="page_item page-item-1052"><a href="http://www.puppetlabs.com/customers/case-studies/" title="Case Studies">Case Studies</a></li>
<li class="page_item page-item-1040"><a href="http://www.puppetlabs.com/customers/product-testimonials/" title="Product Testimonials">Product Testimonials</a></li>
<li class="page_item page-item-872"><a href="http://www.puppetlabs.com/customers/what-customers-are-saying/" title="ervice Testimonials">Service Testimonials</a></li>
	</ul>
          </li>
         <li id="community-tab" class="with-submenu">
            <a href="http://www.puppetlabs.com/community/">
              <span>Community</span>

              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-2195"><a href="http://www.puppetlabs.com/community/overview/" title="Overview">Overview</a></li>
<li class="page_item page-item-2195"><a href="http://www.puppetlabs.com/blog" title="Blog">Blog</a></li>
<li class="page_item page-item-2264"><a href="http://www.puppetlabs.com/community/puppet-camp/" title="Puppet Camp">Puppet Camp</a></li>
<li class="page_item page-item-2249"><a href="http://www.puppetlabs.com/community/user-groups-and-devops-groups/" title="User Groups &amp; DevOps Groups">User Groups &amp; DevOps Groups</a></li>
<li class="page_item page-item-2215"><a href="http://www.puppetlabs.com/community/presentations/" title="Presentations">Presentations</a></li>

<li class="page_item page-item-2217"><a href="http://www.puppetlabs.com/community/videos/" title="Videos">Videos</a></li>
<li class="page_item page-item-2217"><a href="http://www.puppetlabs.com/community/badges/" title="Badges">Badges</a></li>
            </ul>
          </li>

          <li id="company-tab" class="with-submenu">
            <a href="http://www.puppetlabs.com/company/">
              <span>Company</span>
              <span class="drop-down-trigger"></span>
            </a>

            <ul>
              <li class="page_item page-item-2316"><a href="http://www.puppetlabs.com/company/overview/" title="Overview">Overview</a></li>
<li class="page_item page-item-2179"><a href="http://www.puppetlabs.com/company/news/" title="News">News</a></li>
<li class="page_item page-item-1571"><a href="http://www.puppetlabs.com/company/jobs/" title="Jobs">Jobs</a></li>
<li class="page_item page-item-2313"><a href="http://www.puppetlabs.com/company/contact-us/" title="Contact Us">Contact Us</a></li>
            </ul>
          </li>
    		</ul>	   
          <div id="misc-navigation">

			  <ul>
				<li><a href="http://docs.puppetlabs.com">Documentation</a></li>
				<li><a href="http://puppetlabs.com/resources/customer-support/">Support</a></li>
				<li><a href="http://projects.puppetlabs.com/">Bug Tracker</a></li>
				<li><a href="http://puppetlabs.com/company/#contact">Contact Us</a></li>
				<li><a href="http://puppetlabs.com/resources/downloads" class="gateway">Download</a></li>
			  </ul>
			<form action="http://www.google.com/cse" id="cse-search-box">

			  <div>
				<input type="hidden" name="cx" value="017884045025332504017:1mnj-dlgfcc" />
				<input type="hidden" name="ie" value="UTF-8" />
				<input type="text" name="q" size="31" />
				<input type="submit" name="sa" class="searchbtn" value="Search" />
			  </div>
			</form>
			<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en"></script>

          </div>
      </nav>
    	</div>
    </header>  

      <section id="masthead">
        <div class="site-width">
          <h1>Docs: <span class="section-name">Learning — Templates</span></h1>
          <ul id="doc-navigation">
            <li><a href="/">Docs Home</a></li>
            <li class="with-submenu">
              <a href="#">
                <span>Quick Nav</span>
                <span class="drop-down-trigger"></span>
              </a>
               <!-- the following links can't be relative, unfortunately -->
               <!-- future: add some JS to disable this if running from file:// -->
               	            <dl>
	              <dt>Puppet Guides</dt>
                      <dd><a href="/index.html">Index</a></dd>
                  <dt>Puppet References</dt>
                      <dd><a href="/references/stable/type.html">Resource Types</a></dd>
                      <dd><a href="/references/stable/function.html">Functions</a></dd>
                      <dd><a href="/references/stable/metaparameter.html">Metaparameters</a></dd>
                      <dd><a href="/references/stable/configuration.html">Configuration</a></dd>
                      <dt>References By Version</dt>
                      <dd><a href="/references/2.7.3/">2.7.3</a></dd>
                      <dd><a href="/references/2.6.9/">2.6.9</a></dd>
                      <dd><a href="/references/0.25.5/">0.25.5</a></dd>
                      <dd><a href="/references/0.24.8/">0.24.8</a></dd>
                      <dd><a href="/references/">Other Versions</a></dd>
                  <dt>MCollective</dt>
                      <dd><a href="/mcollective/index.html">Index</a></dd>
                      <dd><a href="/mcollective/simplerpc/index.html">SimpleRPC</a></dd>
                      <dd><a href="/mcollective/roadmap/index.html">Roadmap</a></dd>
                      <dd><a href="/mcollective/releasenotes.html">Release Notes</a></dd>
                      <dd><a href="/mcollective/reference/index.html">References</a></dd>
	            </dl>

            </li>
            <li><a href="/contribute.html">Contribute</a></li>
          </ul>
        </div>
      </section>
    
      <section id="content">
        <div class="site-width">
          <div class="primary-secondary-content">
            <div class="primary-content">
              <h1 id="learning--templates">Learning — Templates</h1>

<p>File serving isn&rsquo;t the be-all/end-all of getting content into place. Before we get to parameterized classes and defined types, take a break to learn about templates, which let you make your config files as versatile as your manifests.</p>

<hr />

<p>&larr; <a href="./modules1.html">Modules (part one)</a> &mdash; <a href="./">Index</a> &mdash; <a href="./modules2.html">Modules (part two)</a> &rarr;</p>

<hr />

<h2 id="templating">Templating</h2>

<p>Okay: in the last chapter, you built a module that shipped and managed a configuration file, which was pretty cool. And if you expect all your enterprise Linux systems to use the exact same set of NTP servers, that&rsquo;s probably good enough. Except let&rsquo;s say you decide most of your machines should use internal NTP servers &mdash; whose ntpd configurations are also managed by Puppet, and which should be asking for the time from an external source. The number of files you&rsquo;ll need to ship just multiplied, and they&rsquo;ll only differ by three or four lines, which seems redundant and wasteful. </p>

<p>It would be much better if you could use all the tricks you learned in <a href="./variables.html">Variables, Conditionals, and Facts</a> to rummage around in the actual text of your configuration files. Thus: templates!</p>

<p>Puppet can use <a href="http://cheat.errtheblog.com/s/erb/">ERB templates</a> anywhere a string is called for. (Like a file&rsquo;s <code>content</code> attribute, for instance, or the value of a variable.) Templates go in the (wait for it) <code>templates/</code> directory of a module, and will mostly look like normal configuration files (or what-have-you), except for the occasional <code>&lt;% tag with Ruby code %&gt;</code>.</p>

<p>Yes, Ruby &mdash; unfortunately you can&rsquo;t use the Puppet language in templates. But usually you&rsquo;ll only be printing a variable or doing a simple loop, which you&rsquo;ll get a feel for almost instantly. Anyway, let&rsquo;s cut to the chase: </p>

<h2 id="some-simple-erb">Some Simple ERB</h2>

<p>First, keep in mind that <strong>facts, global variables,</strong> and <strong>variables defined in the current scope</strong> are available to a template as standard Ruby local variables, which are plain words without a <code>$</code> sigil in front of them. Variables from other scopes are reachable, but to read them, you have to call the <code>lookupvar</code> method on the <code>scope</code> object. (For example, <code>scope.lookupvar('apache::user')</code>.) </p>

<h3 id="tags">Tags</h3>

<p>ERB tags are delimited by angle brackets with percent signs just inside. (There isn&rsquo;t any HTML-like concept of opening or closing tags.)</p>

<div class="highlight"><pre><code class="erb"><span class="x">    </span><span class="cp">&lt;%</span> <span class="n">document</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="cp">%&gt;</span><span class="x" />
</code></pre>
</div>

<p>Tags contain one or more lines of Ruby code, which can set variables, munge data, implement control flow, or&hellip; actually, pretty much anything, except for print text in the rendered output.</p>

<h3 id="printing-an-expression">Printing an Expression</h3>

<p>For that, you need to use a printing tag, which looks like a normal tag with an equals sign right after the opening delimiter:</p>

<div class="highlight"><pre><code class="erb"><span class="x">    </span><span class="cp">&lt;%=</span> <span class="n">sectionheader</span> <span class="cp">%&gt;</span><span class="x" />
<span class="x">      environment = </span><span class="cp">&lt;%=</span> <span class="n">gitrevision</span><span class="o">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="o">]</span> <span class="cp">%&gt;</span><span class="x" />
</code></pre>
</div>

<p>The value you print can be a simple variable, or it can be an arbitrarily complicated Ruby expression.</p>

<h3 id="comments">Comments</h3>

<p>A tag with a hash mark right after the opening delimiter can hold comments, which aren&rsquo;t interpreted as code and aren&rsquo;t displayed in the rendered output. </p>

<div class="highlight"><pre><code class="erb"><span class="x">    </span><span class="cp">&lt;%#</span><span class="c"> This comment will be ignored. </span><span class="cp">%&gt;</span><span class="x" />
</code></pre>
</div>

<h3 id="suppressing-line-breaks">Suppressing Line Breaks</h3>

<p>Regular tags don&rsquo;t print anything, but if you keep each tag of logic on its own line, the line breaks you use will show up as a swath of whitespace in the final file. If you don&rsquo;t like that, you can make ERB trim the line break by putting a hyphen directly before the closing delimiter. </p>

<div class="highlight"><pre><code class="erb"><span class="x">    </span><span class="cp">&lt;%</span> <span class="n">document</span> <span class="o">+=</span> <span class="n">thisline</span> <span class="cp">-%&gt;</span><span class="x" />
</code></pre>
</div>

<h2 id="rendering-a-template">Rendering a Template</h2>

<p>To render output from a template, use Puppet&rsquo;s built-in <code>template</code> function: </p>

<div class="highlight"><pre><code class="ruby">    <span class="n">file</span> <span class="p">{</span><span class="s1">&#39;/etc/foo.conf&#39;</span><span class="p">:</span>
      <span class="k">ensure</span>  <span class="o">=&gt;</span> <span class="n">file</span><span class="p">,</span>
      <span class="nb">require</span> <span class="o">=&gt;</span> <span class="no">Package</span><span class="o">[</span><span class="s1">&#39;foo&#39;</span><span class="o">]</span><span class="p">,</span>
      <span class="n">content</span> <span class="o">=&gt;</span> <span class="n">template</span><span class="p">(</span><span class="s1">&#39;foo/foo.conf.erb&#39;</span><span class="p">),</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>This evaluates the template and turns it into a string. Here, we&rsquo;re using that string as the <code>content</code><sup id="fnref:timing"><a href="#fn:timing" rel="footnote">1</a></sup> of a file resource, but like I said above, we could be using it for pretty much anything. <strong>Note that the path to the template doesn&rsquo;t use the same semantics as the path in a <code>puppet:///</code> URL</strong><sup id="fnref:paths"><a href="#fn:paths" rel="footnote">2</a></sup> &mdash; it should be in the form <code>&lt;module name&gt;/&lt;path relative to module's templates directory&gt;</code>. (That is, <code>template('foo/foo.conf.erb')</code> points to <code>/etc/puppetlabs/puppet/modules/foo/templates/foo.conf.erb</code>.)</p>

<p>As a sidenote: if you give more than one argument to the template function&hellip;</p>

<div class="highlight"><pre><code class="ruby">    <span class="n">template</span><span class="p">(</span><span class="s1">&#39;foo/one.erb&#39;</span><span class="p">,</span> <span class="s1">&#39;foo/two.erb&#39;</span><span class="p">)</span>
</code></pre>
</div>

<p>&hellip;it will evaluate each of the templates, then concatenate their outputs and return a single string. </p>

<h3 id="an-aside-other-functions">An Aside: Other Functions</h3>

<p>Since we just went over the template function, this is as good a time as any to cover functions in general. </p>

<p>Most of the Puppet language consists of ways to say &ldquo;Here is a thing, and this is what it is&rdquo; &mdash; resource declarations, class definitions, variable assignments, and the like. Functions are ways to say &ldquo;Do <em>something.</em>&rdquo; They&rsquo;re a bucket for miscellaneous functionality. (You can even write new functions in Ruby and distribute them in modules, if you need to repeatedly munge data or modify your catalogs in some way.)</p>

<p>Puppet&rsquo;s functions are run during catalog compilation,<sup id="fnref:agent"><a href="#fn:agent" rel="footnote">3</a></sup> and they&rsquo;re pretty intuitive to call; it&rsquo;s basically just <code>function(argument, argument, argument)</code>, and you can optionally leave off the parentheses. (Remember that <code>include</code> is also a function.) Some functions (like <code>template</code>) get replaced with a return value, and others (like <code>include</code>) take effect silently. </p>

<p>You can read the full list of available functions at the <a href="http://docs.puppetlabs.com/references/stable/function.html">function reference</a>. We won&rsquo;t be covering most of these for a while, but you might find <code>inline_template</code> and <code>regsubst</code> useful in the short term.</p>

<h2 id="an-example-ntp-again">An Example: NTP Again</h2>

<p>So let&rsquo;s modify your NTP module to use templates instead of static config files. </p>

<p>First, we&rsquo;ll change the <code>init.pp</code> manifest:</p>

<div class="highlight"><pre><code class="ruby">    <span class="c1"># init.pp</span>
    
    <span class="k">class</span> <span class="n">ntp</span> <span class="p">{</span>
      <span class="k">case</span> <span class="vg">$operatingsystem</span> <span class="p">{</span>
        <span class="n">centos</span><span class="p">,</span> <span class="n">redhat</span><span class="p">:</span> <span class="p">{</span> 
          <span class="vg">$service_name</span>    <span class="o">=</span> <span class="s1">&#39;ntpd&#39;</span>
          <span class="vg">$conf_template</span>   <span class="o">=</span> <span class="s1">&#39;ntp.conf.el.erb&#39;</span>
          <span class="vg">$default_servers</span> <span class="o">=</span> <span class="o">[</span> <span class="s2">&quot;0.centos.pool.ntp.org&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;1.centos.pool.ntp.org&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;2.centos.pool.ntp.org&quot;</span><span class="p">,</span> <span class="o">]</span>
        <span class="p">}</span>
        <span class="n">debian</span><span class="p">,</span> <span class="n">ubuntu</span><span class="p">:</span> <span class="p">{</span> 
          <span class="vg">$service_name</span>    <span class="o">=</span> <span class="s1">&#39;ntp&#39;</span>
          <span class="vg">$conf_template</span>   <span class="o">=</span> <span class="s1">&#39;ntp.conf.debian.erb&#39;</span>
          <span class="vg">$default_servers</span> <span class="o">=</span> <span class="o">[</span> <span class="s2">&quot;0.debian.pool.ntp.org iburst&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;1.debian.pool.ntp.org iburst&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;2.debian.pool.ntp.org iburst&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;3.debian.pool.ntp.org iburst&quot;</span><span class="p">,</span> <span class="o">]</span>
        <span class="p">}</span>
      <span class="p">}</span>
      
      <span class="k">if</span> <span class="vg">$servers</span> <span class="o">==</span> <span class="k">undef</span> <span class="p">{</span>
        <span class="vg">$servers_real</span> <span class="o">=</span> <span class="vg">$default_servers</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="vg">$servers_real</span> <span class="o">=</span> <span class="vg">$servers</span>
      <span class="p">}</span>
      
      <span class="n">package</span> <span class="p">{</span> <span class="s1">&#39;ntp&#39;</span><span class="p">:</span>
        <span class="k">ensure</span> <span class="o">=&gt;</span> <span class="n">installed</span><span class="p">,</span>
      <span class="p">}</span>
      
      <span class="n">service</span> <span class="p">{</span> <span class="s1">&#39;ntp&#39;</span><span class="p">:</span>
        <span class="nb">name</span>      <span class="o">=&gt;</span> <span class="vg">$service_name</span><span class="p">,</span>
        <span class="k">ensure</span>    <span class="o">=&gt;</span> <span class="n">running</span><span class="p">,</span>
        <span class="n">enable</span>    <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span>
        <span class="n">subscribe</span> <span class="o">=&gt;</span> <span class="no">File</span><span class="o">[</span><span class="s1">&#39;ntp.conf&#39;</span><span class="o">]</span><span class="p">,</span>
      <span class="p">}</span>
      
      <span class="n">file</span> <span class="p">{</span> <span class="s1">&#39;ntp.conf&#39;</span><span class="p">:</span>
        <span class="n">path</span>    <span class="o">=&gt;</span> <span class="s1">&#39;/etc/ntp.conf&#39;</span><span class="p">,</span>
        <span class="k">ensure</span>  <span class="o">=&gt;</span> <span class="n">file</span><span class="p">,</span>
        <span class="nb">require</span> <span class="o">=&gt;</span> <span class="no">Package</span><span class="o">[</span><span class="s1">&#39;ntp&#39;</span><span class="o">]</span><span class="p">,</span>
        <span class="n">content</span> <span class="o">=&gt;</span> <span class="n">template</span><span class="p">(</span><span class="s2">&quot;ntp/${conf_template}&quot;</span><span class="p">),</span>
      <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>There are several things going on, here: </p>

<ul>
  <li>We changed the <code>File['ntp.conf']</code> resource, as advertised.</li>
  <li>We&rsquo;re storing the servers in an array, mostly so I can demonstrate how to iterate over an array once we get to the template. If you wanted to, you could store them as a string with line breaks and per-line <code>server</code> statements instead; it comes down to a combination of personal style and the nature of the problem at hand.</li>
  <li>We&rsquo;ll be using that <code>$servers_real</code> variable in the actual template, which might seem odd now but will make more sense during the next chapter. Likewise with testing whether <code>$servers</code> is <code>undef</code>. (For now, it will always be <code>undef</code>, as are all variables that haven&rsquo;t been assigned yet.)</li>
</ul>

<p>Next, copy the config files to the templates directory, add the <code>.erb</code> extension to their names, and replace the blocks of servers with some choice ERB code:</p>

<div class="highlight"><pre><code class="erb"><span class="x">    # ...</span>
<span class="x">    </span>
<span class="x">    # Managed by Class[&#39;ntp&#39;]</span>
<span class="x">    </span><span class="cp">&lt;%</span> <span class="n">servers_real</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">server</span><span class="o">|</span> <span class="cp">-%&gt;</span><span class="x" />
<span class="x">    server </span><span class="cp">&lt;%=</span> <span class="n">server</span> <span class="cp">%&gt;</span><span class="x" />
<span class="x">    </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">-%&gt;</span><span class="x" />
<span class="x">    </span>
<span class="x">    # ...</span>
</code></pre>
</div>

<p>This snippet will iterate over each entry in the array and print it after a <code>server</code> statement, so, for example, the string generated from the Debian template will end up with a block like this: </p>

<pre><code># Managed by Class['ntp']
server 0.debian.pool.ntp.org iburst
server 1.debian.pool.ntp.org iburst
server 2.debian.pool.ntp.org iburst
server 3.debian.pool.ntp.org iburst
</code></pre>

<p>You can see the limitations here &mdash; the servers are still basically hardcoded. But we&rsquo;ve moved them out of the config file and into the Puppet manifest, which gets us half of the way to a much more flexible NTP class. </p>

<h2 id="next">Next</h2>

<p>And as for the rest of the way, keep reading to learn about <a href="./modules2.html">parameterized classes</a>. </p>
<div class="footnotes">
  <ol>
    <li id="fn:timing">
      <p>This is a good time to remind you that filling a <code>content</code> attribute  happens during catalog compilation, and serving a file with a <code>puppet:///</code> URL happens during catalog application. Again, this doesn&rsquo;t matter right now, but it may make some things clearer later.<a href="#fnref:timing" rev="footnote">&#8617;</a></p>
    </li>
    <li id="fn:paths">
      <p>This inconsistency is one of those problems that tend to crop up over time when software grows organically. We&rsquo;re working on it, and you can keep an eye on <a href="http://projects.puppetlabs.com/issues/4885">ticket #4885</a> if that sort of thing interests you.<a href="#fnref:paths" rev="footnote">&#8617;</a></p>
    </li>
    <li id="fn:agent">
      <p>To jump ahead a bit, this means the agent never sees them.<a href="#fnref:agent" rev="footnote">&#8617;</a></p>
    </li>
  </ol>
</div>

            </div>
            <div class="secondary-content">
                  <div id="subCol">
                  
                  
                      <h3 class="chapter">Contents</h3>
                      
<ol class="toc">
  <li class="toc-lv2"><a href="#templating">Templating</a></li>
  <li class="toc-lv2"><a href="#some-simple-erb">Some Simple ERB</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#tags">Tags</a></li>
   <li class="toc-lv3"><a href="#printing-an-expression">Printing an Expression</a></li>
   <li class="toc-lv3"><a href="#comments">Comments</a></li>
   <li class="toc-lv3"><a href="#suppressing-line-breaks">Suppressing Line Breaks</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#rendering-a-template">Rendering a Template</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#an-aside-other-functions">An Aside: Other Functions</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#an-example-ntp-again">An Example: NTP Again</a></li>
  <li class="toc-lv2"><a href="#next">Next</a></li>
</ol>
                  
                                        <!-- New Ads are inserted here -->
		  			<div id="bannerImage" style="display:block;">&nbsp;</div>
		  			<!-- Remove me on September 24 --><a href="http://bit.ly/puppetconf"><img src="http://www.puppetlabs.com/wp-content/uploads/2011/07/120x600_puppetconf.png" style="display:block; margin-left: auto; margin-right: auto;"></a>
                  </div>
            </div>
          </div>
        </div>
      </section>

		<footer id="footer">
      <div class="site-width">

        <div class="primary-secondary-content">
          <div class="primary-content">
            <section id="newsletter">
                 <h4>Puppet Labs is Hiring</h4>
                 <p><a href="http://www.puppetlabs.com/company/jobs/">Engineers, developers & consultants</a>
                  <p>  
		<h4>Newsletter</h4>

              <p>Stay up to date on all things puppet</p>
              
				<form class="lpeRegForm formNotEmpty" method="post" enctype="application/x-www-form-urlencoded" action="http://info.puppetlabs.com/index.php/leadCapture/save"; id="mktForm_1013" name="mktForm_1013">
				
				<label>Email Address:</label><span class='mktInput'><input class='mktFormText mktFormEmail' name="Email" id="Email" type='text' value="" maxlength='255'  /><span class='mktFormMsg'></span></span>
				
				<input id='mktFrmSubmit' type='submit' class='btn' style="width: auto; overflow: visible; padding-left: .25em; padding-right: .25em;" value='Subscribe' name='submitButton' onclick='formSubmit(document.getElementById("mktForm_1013")); return false;' />
				
				<input style='display: none;' id='mktFrmReset' type='reset' value='Clear' name='resetButton' onclick='formReset(document.getElementById("mktForm_1013")); return false;' />
	
				<span style="display:none;"><input type="text" name="_marketo_comments" value="" /></span>
				<input type="hidden" name="lpId" value="-1" />
				<input type="hidden" name="subId" value="100" />

				<input type="hidden" name="kw" value="" />
				<input type="hidden" name="cr" value="" />
				
				<input type="hidden" name="searchstr" value="" />
				<input type="hidden" name="lpurl" value="http://info.puppetlabs.com/testsubscription.html?cr={creative}&kw={keyword}"; />
				<input type="hidden" name="formid" value="1013" />
				<input type="hidden" name="returnURL" value="http://www.puppetlabs.com/misc/subscription-thank-you/"; />
				<input type="hidden" name="retURL" value="http://www.puppetlabs.com/misc/subscription-thank-you/"; />
				<input type="hidden" name="_mkt_disp" value="return" />
				<input type="hidden" name="_mkt_trk" value="" />

				</form>
				<script type="text/javascript" src="http://info.puppetlabs.com/js/mktFormSupport.js"></script>
				
				<script type="text/javascript">
				function formSubmit(elt) {
				return Mkto.formSubmit(elt);
				}
				function formReset(elt) {
				return Mkto.formReset(elt);
				}
				</script>
              
<a href="http://info.puppetlabs.com/puppet-enterprise" class="fbtn">Try Puppet Enterprise FREE</a>

            </section>
            <section id="elsewhere">
              <h4>Get Involved</h4>
              <ul>

                <li class="chat"><a href="http://webchat.freenode.net/?channels=puppet" rel="external"><span class="indicator"></span><span>Chat with us on IRC</span></a></li>
		<li class="discussion"><a href="http://groups.google.com/group/puppet-dev" rel="external"><span class="indicator"></span><span>Join the Puppet Developer List</span></a></li>
                <li class="discussion"><a href="http://groups.google.com/group/puppet-users?pli=1" rel="external"><span class="indicator"></span><span>Join the Puppet User List</span></a></li>
                
                <li class="linkedin"><a href="http://www.linkedin.com/groups?about=&gid=696467&trk=anet_ug_grppro" rel="external"><span class="indicator"></span><span>Join the Puppet Users LinkedIn group</span></a></li>	

              </ul>
		<p>
		              		<h4>Follow us&#8230;</h4>

              		<ul class="followus">

					
			<li><a href="http://feeds.feedburner.com/PuppetLabs" target="_blank"><img src="http://www.puppetlabs.com/wp-content/plugins/my-profiles/images/rss.png" border="0"></a></li>
			<li><a href="http://www.facebook.com/pages/Puppet-Labs/219089920711" target="_blank"><img src="http://www.puppetlabs.com//wp-content/plugins/my-profiles/images/facebook.png" border="0"></a></li>
			<li><a href="http://www.twitter.com/puppetlabs" target="_blank"><img src="http://www.puppetlabs.com//wp-content/plugins/my-profiles/images/twitter.png" border="0"></a></li>
			<li><a href="http://www.linkedin.com/groups?about=&amp;gid=696467&amp;trk=anet_ug_grppro" target="_blank"><img src="http://www.puppetlabs.com//wp-content/uploads/2011/01/LinkedIn_IN_Icon_32px.png" border="0"></a></li>    <li><a href="https://github.com/puppetlabs" target="_blank"><img src="http://www.puppetlabs.com//wp-content/uploads/2011/01/github_icon.png" border="0"></a></li>
					</ul>

              	</p>

            </section>
          </div>
          <div class="secondary-content">
            <section id="book-it">
              <h4>Get the book!</h4>

              <p>Written by James Turnbull and Jeff McCune, <a href="http://www.apress.com/9781430230571" rel="nofollow">Pro Puppet</a> is a comprehensive and up-to-date look at Puppet and MCollective. </p>
              <a href="http://www.apress.com/9781430230571" rel="nofollow"><img src="http://www.puppetlabs.com/wp-content/uploads/2011/05/propuppetthumb.png" /></a>
            </section>
          </div>
        </div>
      </div>
		</footer>

    <div id="copyright">
      <div class="site-width">
        &copy; 2011 <a href="http://www.puppetlabs.com/" title="Puppet Labs">Puppet Labs</a>
        <span class="vcard">
         <span class="org"></span>
         <a class="email" href="mailto:info@puppetlabs.com">info@puppetlabs.com</a>

          <span class="adr">
           <span class="street-address">411 NW Park Avenue</span>
           /
           <span class="locality">Portland</span>, 
           <span class="region">OR</span>
           <span class="postal-code">97209</span>

          </span>

         <span class="tel">1-877-575-9775</span>
        </span>          
      </div>
    </div>
    <script src="http://munchkin.marketo.net/munchkin.js" type="text/javascript"></script> <script>mktoMunchkin("307-QLA-991");</script> 
    
  	<script type="text/javascript">Cufon.now();</script>
  	<style type="text/css">h1, h2, .btn { visibility : visible; }</style>

	</body>
</html>        
